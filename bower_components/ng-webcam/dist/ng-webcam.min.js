!function(){"use strict";function n(){function n(){return['<div class="ng-webcam">','<div id="ng-webcam-container"></div>'].join("")}function e(n,e,i,o){o.init(),n.$on("$destroy",function(){o.destroy()})}function i(n,e,i){function o(){l.config=l.config||{},angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),c(),a()}function t(){Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1}function a(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100}),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){if(angular.isDefined(l.onError))return l.onError({err:n})})}function r(n){u&&u.play(),n===l.config.shots-1&&e.cancel(d),Webcam.snap(function(e){if(h[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var i=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:i})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:h})})}function f(){var n=0;d=e(function(){r(n),n++},1e3*l.config.delay,l.config.shots)}function g(){Webcam.attach("#ng-webcam-container")}function s(){t()}var u,d,l=this,h=[];l.webcamLoaded=!1,l.webcamLive=!1,l.progress="0%",l.init=o,l.destroy=t,n.$on("ngWebcam_capture",f),n.$on("ngWebcam_on",g),n.$on("ngWebcam_off",s)}var o={restrict:"E",template:n,link:e,bindToController:!0,controller:i,controllerAs:"cam",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return i.$inject=["$scope","$interval","$window"],o}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsIiR3aW5kb3ciLCJ2bSIsImNvbmZpZyIsImFuZ3VsYXIiLCJpc1VuZGVmaW5lZCIsInZpZXdlcldpZHRoIiwidmlld2VySGVpZ2h0Iiwib3V0cHV0V2lkdGgiLCJvdXRwdXRIZWlnaHQiLCJkZWxheSIsInNob3RzIiwiY29uZmlndXJlTGlzdGVuZXJzIiwiY29uZmlndXJlIiwiV2ViY2FtIiwicmVzZXQiLCJ3ZWJjYW1MaXZlIiwid2ViY2FtTG9hZGVkIiwiaXNEZWZpbmVkIiwic2h1dHRlclVybCIsInNvdW5kIiwiQXVkaW8iLCJhdXRvcGxheSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwic3JjIiwic3BsaXQiLCJzZXQiLCJ3aWR0aCIsImhlaWdodCIsImRlc3Rfd2lkdGgiLCJkZXN0X2hlaWdodCIsImZvcmNlX2ZsYXNoIiwiaW1hZ2VfZm9ybWF0IiwianBlZ19xdWFsaXR5IiwiZmxhc2hGYWxsYmFja1VybCIsInNldFNXRkxvY2F0aW9uIiwiZmxhc2hOb3REZXRlY3RlZFRleHQiLCJhdHRhY2giLCJvbiIsIiRhcHBseSIsIm9uTG9hZCIsIm9uTGl2ZSIsImVyciIsIm9uRXJyb3IiLCJjYXB0dXJlIiwiaW5kZXgiLCJwbGF5IiwiY2FuY2VsIiwidGltZXIiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXNCQSxTQUFBQSxLQWtCQSxRQUFBQyxLQUNBLE9BQUEsMEJBQ0Esd0NBQUFDLEtBQUEsSUFHQSxRQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxPQUNBSixFQUFBSyxJQUFBLFdBQUEsV0FDQUYsRUFBQUcsWUFNQSxRQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxHQTRDQSxRQUFBTixLQUNBTyxFQUFBQyxPQUFBRCxFQUFBQyxXQUNBQyxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBRyxlQUFBSixFQUFBQyxPQUFBRyxZQUFBLFFBQ0FGLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFJLGdCQUFBTCxFQUFBQyxPQUFBSSxhQUFBLFFBQ0FILFFBQUFDLFlBQUFILEVBQUFDLE9BQUFLLGVBQUFOLEVBQUFDLE9BQUFLLFlBQUEsS0FDQUosUUFBQUMsWUFBQUgsRUFBQUMsT0FBQU0sZ0JBQUFQLEVBQUFDLE9BQUFNLGFBQUEsS0FDQUwsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQU8sU0FBQVIsRUFBQUMsT0FBQU8sTUFBQSxHQUNBTixRQUFBQyxZQUFBSCxFQUFBQyxPQUFBUSxTQUFBVCxFQUFBQyxPQUFBUSxNQUFBLEdBQ0FDLElBQ0FDLElBR0EsUUFBQWhCLEtBQ0FpQixPQUFBQyxRQUNBYixFQUFBYyxZQUFBLEVBQ0FkLEVBQUFlLGNBQUEsRUFHQSxRQUFBSixLQUNBVCxRQUFBYyxVQUFBaEIsRUFBQUMsT0FBQWdCLGNBQ0FDLEVBQUEsR0FBQUMsT0FDQUQsRUFBQUUsVUFBQSxFQUNBQyxVQUFBQyxVQUFBQyxNQUFBLFdBQ0FMLEVBQUFNLElBQUF4QixFQUFBQyxPQUFBZ0IsV0FBQVEsTUFBQSxLQUFBLEdBQUEsT0FFQVAsRUFBQU0sSUFBQXhCLEVBQUFDLE9BQUFnQixZQUdBTCxPQUFBYyxLQUNBQyxNQUFBM0IsRUFBQUMsT0FBQUcsWUFDQXdCLE9BQUE1QixFQUFBQyxPQUFBSSxhQUNBd0IsV0FBQTdCLEVBQUFDLE9BQUFLLFlBQ0F3QixZQUFBOUIsRUFBQUMsT0FBQU0sYUFDQXdCLGFBQUEsRUFDQUMsYUFBQSxPQUNBQyxhQUFBLE1BRUEvQixRQUFBYyxVQUFBaEIsRUFBQUMsT0FBQWlDLG1CQUNBdEIsT0FBQXVCLGVBQUFuQyxFQUFBQyxPQUFBaUMsa0JBRUFoQyxRQUFBYyxVQUFBaEIsRUFBQUMsT0FBQW1DLHVCQUNBeEIsT0FBQWMsSUFBQSx1QkFBQTFCLEVBQUFDLE9BQUFtQyxzQkFFQXhCLE9BQUF5QixPQUFBLHdCQUdBLFFBQUEzQixLQUNBRSxPQUFBMEIsR0FBQSxPQUFBLFdBQ0F6QyxFQUFBMEMsT0FBQSxXQUNBdkMsRUFBQWUsY0FBQSxFQUNBYixRQUFBYyxVQUFBaEIsRUFBQXdDLFNBQ0F4QyxFQUFBd0MsYUFJQTVCLE9BQUEwQixHQUFBLE9BQUEsV0FDQXpDLEVBQUEwQyxPQUFBLFdBQ0F2QyxFQUFBYyxZQUFBLEVBQ0FaLFFBQUFjLFVBQUFoQixFQUFBeUMsU0FDQXpDLEVBQUF5QyxhQUlBN0IsT0FBQTBCLEdBQUEsUUFBQSxTQUFBSSxHQUNBLEdBQUF4QyxRQUFBYyxVQUFBaEIsRUFBQTJDLFNBQ0EsTUFBQTNDLEdBQUEyQyxTQUFBRCxJQUFBQSxNQUtBLFFBQUFFLEdBQUFDLEdBQ0EzQixHQUNBQSxFQUFBNEIsT0FFQUQsSUFBQTdDLEVBQUFDLE9BQUFRLE1BQUEsR0FDQVgsRUFBQWlELE9BQUFDLEdBRUFwQyxPQUFBcUMsS0FBQSxTQUFBQyxHQUVBLEdBREFDLEVBQUFOLEdBQUFLLEVBQ0FMLEVBQUE3QyxFQUFBQyxPQUFBUSxNQUFBLEdBQUFQLFFBQUFjLFVBQUFoQixFQUFBb0QsbUJBQUEsQ0FDQSxHQUFBQyxHQUFBQyxLQUFBQyxNQUFBLEtBQUFWLEVBQUEsR0FBQTdDLEVBQUFDLE9BQUFRLE1BQ0FULEdBQUFvRCxtQkFBQTVCLElBQUEwQixFQUFBRyxTQUFBQSxJQUVBLEdBQUFSLElBQUE3QyxFQUFBQyxPQUFBUSxNQUFBLEdBQUFQLFFBQUFjLFVBQUFoQixFQUFBd0QsbUJBQ0EsTUFBQXhELEdBQUF3RCxtQkFBQWhDLElBQUEyQixNQUtBLFFBQUFNLEtBQ0EsR0FBQUMsR0FBQSxDQUNBVixHQUFBbEQsRUFBQSxXQUNBOEMsRUFBQWMsR0FDQUEsS0FDQSxJQUFBMUQsRUFBQUMsT0FBQU8sTUFBQVIsRUFBQUMsT0FBQVEsT0FHQSxRQUFBa0QsS0FDQS9DLE9BQUF5QixPQUFBLHdCQUdBLFFBQUF1QixLQUNBakUsSUFoSkEsR0FDQXVCLEdBQUE4QixFQURBaEQsRUFBQTZELEtBRUFWLElBQ0FuRCxHQUFBZSxjQUFBLEVBQ0FmLEVBQUFjLFlBQUEsRUFDQWQsRUFBQXFELFNBQUEsS0FDQXJELEVBQUFQLEtBQUFBLEVBQ0FPLEVBQUFMLFFBQUFBLEVBV0FFLEVBQUFILElBQUEsbUJBQUErRCxHQVdBNUQsRUFBQUgsSUFBQSxjQUFBaUUsR0FXQTlELEVBQUFILElBQUEsZUFBQWtFLEdBekVBLEdBQUFFLElBQ0FDLFNBQUEsSUFDQTdFLFNBQUFBLEVBQ0FFLEtBQUFBLEVBQ0E0RSxrQkFBQSxFQUNBQyxXQUFBckUsRUFDQXNFLGFBQUEsTUFDQTdFLE9BQ0FZLE9BQUEsSUFDQXVELGtCQUFBLElBQ0FiLFFBQUEsSUFDQUgsT0FBQSxJQUNBWSxrQkFBQSxJQUNBWCxPQUFBLEtBNkxBLE9BN0tBN0MsR0FBQXVFLFNBQUEsU0FBQSxZQUFBLFdBNktBTCxFQWhPQTVELFFBQUFrRSxPQUFBLGdCQUFBTixVQUFBLFdBQUE3RSxHQUNBQSxFQUFBa0YiLCJmaWxlIjoibmctd2ViY2FtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyLm1vZHVsZSgnbmctd2ViY2FtJywgW10pLmRpcmVjdGl2ZSgnbmdXZWJjYW0nLCBuZ1dlYmNhbSk7XG4gIG5nV2ViY2FtLiRpbmplY3QgPSBbXTtcbiAgLyoqXG4gICAqICBAbmdkb2MgRGlyZWN0aXZlXG4gICAqICBAbmFtZSBuZy13ZWJjYW1cbiAgICogIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiAgRGlyZWN0aXZlIGZvciBjYXB0dXJpbmcgaW1hZ2VzIGZyb20geW91ciBjb21wdXRlcidzIGNhbWVyYSwgYW5kIGRlbGl2ZXJ5IHRoZW4gdG8geW91IGFzIGRhdGEgdXJpXG4gICAqXG4gICAqICBAdXNhZ2VcbiAgICogIGBgYGh0bWxcbiAgICogIDxuZy13ZWJjYW1cbiAgICogICAgY29uZmlnPVwidm0uY29uZmlnXCJcbiAgICogICAgb24tZXJyb3I9XCJ2bS5vbkVycm9yKGVycilcIlxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxuICAgKiAgICBvbi1saXZlPVwidm0ub25MaXZlKClcIlxuICAgKiAgICBvbi1jYXB0dXJlLXByb2dyZXNzPVwidm0ub25DYXB0dXJlUHJvZ3Jlc3Moc3JjLCBwcm9ncmVzcylcIlxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxuICAgKiAgPC9uZy13ZWJjYW0+XG4gICAqICBgYGBcbiAgICovXG4gIGZ1bmN0aW9uIG5nV2ViY2FtKCkge1xuICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlLFxuICAgICAgbGluazogbGluayxcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICBjb250cm9sbGVyOiBuZ1dlYmNhbUNvbnRyb2xsZXIsXG4gICAgICBjb250cm9sbGVyQXM6ICdjYW0nLFxuICAgICAgc2NvcGU6IHtcbiAgICAgICAgY29uZmlnOiAnPScsXG4gICAgICAgIG9uQ2FwdHVyZUNvbXBsZXRlOiAnJicsXG4gICAgICAgIG9uRXJyb3I6ICcmJyxcbiAgICAgICAgb25Mb2FkOiAnJicsXG4gICAgICAgIG9uQ2FwdHVyZVByb2dyZXNzOiAnJicsXG4gICAgICAgIG9uTGl2ZTogJyYnXG4gICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHRlbXBsYXRlKCkge1xuICAgICAgcmV0dXJuIFsnPGRpdiBjbGFzcz1cIm5nLXdlYmNhbVwiPicsXG4gICAgICAgICc8ZGl2IGlkPVwibmctd2ViY2FtLWNvbnRhaW5lclwiPjwvZGl2PiddLmpvaW4oJycpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XG4gICAgICBjdHJsLmluaXQoKTtcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY3RybC5kZXN0cm95KCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ1dlYmNhbUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRpbnRlcnZhbCcsICckd2luZG93J107XG5cbiAgICBmdW5jdGlvbiBuZ1dlYmNhbUNvbnRyb2xsZXIoJHNjb3BlLCAkaW50ZXJ2YWwsICR3aW5kb3cpIHtcbiAgICAgIC8qanNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZhciBzb3VuZCwgdGltZXI7XG4gICAgICB2YXIgaW1hZ2VzID0gW107XG4gICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcbiAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcbiAgICAgIHZtLnByb2dyZXNzID0gJzAlJztcbiAgICAgIHZtLmluaXQgPSBpbml0O1xuICAgICAgdm0uZGVzdHJveSA9IGRlc3Ryb3k7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9jYXB0dXJlXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXG4gICAgICAgKlxuICAgICAgICogIExpc3RlbmVyIGZvciBjYXB0dXJlIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fY2FwdHVyZScpO2BcbiAgICAgICAqL1xuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fY2FwdHVyZScsIG9uV2ViY2FtQ2FwdHVyZSk7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vblxuICAgICAgICogIEBkZXNjcmlwdGlvblxuICAgICAgICpcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9uIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb24nKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29uJywgb25XZWJjYW1Pbik7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vZmZcbiAgICAgICAqICBAZGVzY3JpcHRpb25cbiAgICAgICAqXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvZmYgdXNlciBhY3Rpb25cbiAgICAgICAqXG4gICAgICAgKiAgQHVzYWdlXG4gICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9vZmYnKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29mZicsIG9uV2ViY2FtT2ZmKTtcblxuICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgdm0uY29uZmlnID0gdm0uY29uZmlnIHx8IHt9O1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy52aWV3ZXJXaWR0aCkpIHZtLmNvbmZpZy52aWV3ZXJXaWR0aCA9ICdhdXRvJztcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VySGVpZ2h0KSkgdm0uY29uZmlnLnZpZXdlckhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0V2lkdGgpKSB2bS5jb25maWcub3V0cHV0V2lkdGggPSAzMjA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLm91dHB1dEhlaWdodCkpIHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQgPSAyNDA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmRlbGF5KSkgdm0uY29uZmlnLmRlbGF5ID0gMDtcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuc2hvdHMpKSB2bS5jb25maWcuc2hvdHMgPSAxO1xuICAgICAgICBjb25maWd1cmVMaXN0ZW5lcnMoKTtcbiAgICAgICAgY29uZmlndXJlKCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICAgIFdlYmNhbS5yZXNldCgpO1xuICAgICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XG4gICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjb25maWd1cmUoKSB7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5zaHV0dGVyVXJsKSkge1xuICAgICAgICAgIHNvdW5kID0gbmV3IEF1ZGlvKCk7XG4gICAgICAgICAgc291bmQuYXV0b3BsYXkgPSBmYWxzZTtcbiAgICAgICAgICBpZihuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9GaXJlZm94LykpIHtcbiAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsLnNwbGl0KCcuJylbMF0gKyAnLm9nZyc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBXZWJjYW0uc2V0KHtcbiAgICAgICAgICB3aWR0aDogdm0uY29uZmlnLnZpZXdlcldpZHRoLFxuICAgICAgICAgIGhlaWdodDogdm0uY29uZmlnLnZpZXdlckhlaWdodCxcbiAgICAgICAgICBkZXN0X3dpZHRoOiB2bS5jb25maWcub3V0cHV0V2lkdGgsXG4gICAgICAgICAgZGVzdF9oZWlnaHQ6IHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQsXG4gICAgICAgICAgZm9yY2VfZmxhc2g6IGZhbHNlLFxuICAgICAgICAgIGltYWdlX2Zvcm1hdDogJ2pwZWcnLFxuICAgICAgICAgIGpwZWdfcXVhbGl0eTogMTAwXG4gICAgICAgIH0pO1xuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCkpIHtcbiAgICAgICAgICBXZWJjYW0uc2V0U1dGTG9jYXRpb24odm0uY29uZmlnLmZsYXNoRmFsbGJhY2tVcmwpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaE5vdERldGVjdGVkVGV4dCkpIHtcbiAgICAgICAgICBXZWJjYW0uc2V0KCdmbGFzaE5vdERldGVjdGVkVGV4dCcsIHZtLmNvbmZpZy5mbGFzaE5vdERldGVjdGVkVGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlTGlzdGVuZXJzKCkge1xuICAgICAgICBXZWJjYW0ub24oJ2xvYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ud2ViY2FtTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uTG9hZCkpIHtcbiAgICAgICAgICAgICAgdm0ub25Mb2FkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBXZWJjYW0ub24oJ2xpdmUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxpdmUpKSB7XG4gICAgICAgICAgICAgIHZtLm9uTGl2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgV2ViY2FtLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uRXJyb3IpKSB7XG4gICAgICAgICAgICByZXR1cm4gdm0ub25FcnJvcih7ZXJyOmVycn0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNhcHR1cmUoaW5kZXgpIHtcbiAgICAgICAgaWYoc291bmQpIHtcbiAgICAgICAgICBzb3VuZC5wbGF5KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkpIHtcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHRpbWVyKTtcbiAgICAgICAgfVxuICAgICAgICBXZWJjYW0uc25hcChmdW5jdGlvbihkYXRhX3VyaSkge1xuICAgICAgICAgIGltYWdlc1tpbmRleF0gPSBkYXRhX3VyaTtcbiAgICAgICAgICBpZihpbmRleCA8ICh2bS5jb25maWcuc2hvdHMtMSkgJiYgYW5ndWxhci5pc0RlZmluZWQodm0ub25DYXB0dXJlUHJvZ3Jlc3MpKSB7XG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKCgoaW5kZXgrMSkgKiAxMDApIC8gdm0uY29uZmlnLnNob3RzKTtcbiAgICAgICAgICAgIHZtLm9uQ2FwdHVyZVByb2dyZXNzKHtzcmM6IGRhdGFfdXJpLHByb2dyZXNzOiBwcm9ncmVzc30pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVDb21wbGV0ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB2bS5vbkNhcHR1cmVDb21wbGV0ZSh7c3JjOiBpbWFnZXN9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbUNhcHR1cmUoKSB7XG4gICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgIHRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PbigpIHtcbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PZmYoKSB7XG4gICAgICAgIGRlc3Ryb3koKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gaGFzVXNlck1lZGlhKCkge1xuICAgICAgICByZXR1cm4gKCR3aW5kb3cubmF2aWdhdG9yLmdldFVzZXJNZWRpYSB8fCAkd2luZG93Lm5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEgfHxcbiAgICAgICAgJHdpbmRvdy5uYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhIHx8ICR3aW5kb3cubmF2aWdhdG9yLm1zR2V0VXNlck1lZGlhKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYnJvd3NlcnMoKSB7XG4gICAgICAgIC8qanNoaW50IG1heGNvbXBsZXhpdHk6IDQwICovXG4gICAgICAgIHZhciB1YT0gJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LCB0ZW0sXG4gICAgICAgICAgICBNPSB1YS5tYXRjaCgvKG9wZXJhfGNocm9tZXxzYWZhcml8ZmlyZWZveHxtc2llfHRyaWRlbnQoPz1cXC8pKVxcLz9cXHMqKFxcZCspL2kpIHx8IFtdO1xuICAgICAgICBpZigvdHJpZGVudC9pLnRlc3QoTVsxXSkpe1xuICAgICAgICAgIHRlbT0gIC9cXGJydlsgOl0rKFxcZCspL2cuZXhlYyh1YSkgfHwgW107XG4gICAgICAgICAgcmV0dXJuICdJRSAnKyh0ZW1bMV0gfHwgJycpO1xuICAgICAgICB9XG4gICAgICAgIGlmKE1bMV09PT0gJ0Nocm9tZScpe1xuICAgICAgICAgIHRlbT0gdWEubWF0Y2goL1xcYihPUFJ8RWRnZSlcXC8oXFxkKykvKTtcbiAgICAgICAgICBpZih0ZW0hPSBudWxsKSByZXR1cm4gdGVtLnNsaWNlKDEpLmpvaW4oJyAnKS5yZXBsYWNlKCdPUFInLCAnT3BlcmEnKTtcbiAgICAgICAgfVxuICAgICAgICBNPSBNWzJdPyBbTVsxXSwgTVsyXV06IFtuYXZpZ2F0b3IuYXBwTmFtZSwgbmF2aWdhdG9yLmFwcFZlcnNpb24sICctPyddO1xuICAgICAgICBpZigodGVtPSB1YS5tYXRjaCgvdmVyc2lvblxcLyhcXGQrKS9pKSkhPSBudWxsKSBNLnNwbGljZSgxLCAxLCB0ZW1bMV0pO1xuICAgICAgICByZXR1cm4gTS5qb2luKCcgJyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaXJlY3RpdmU7XG4gIH1cbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
