!function(){"use strict";function n(){function n(n,e){return['<div ng-show="cam.webcamLive === true" class="ng-webcam" ng-class="{\'no-overlay\' : cam.counter === 0 || cam.config.countdown === 0}">','<span ng-show="cam.config.countdown >= 0" id="counter">{{cam.counter}}</span>','<div id="ng-webcam-container" class="ng-webcam-continer"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e,o){function i(){h.config=h.config||{},angular.isUndefined(h.config.viewerWidth)&&(h.config.viewerWidth="auto"),angular.isUndefined(h.config.viewerHeight)&&(h.config.viewerHeight="auto"),angular.isUndefined(h.config.outputWidth)&&(h.config.outputWidth=320),angular.isUndefined(h.config.outputHeight)&&(h.config.outputHeight=240),angular.isUndefined(h.config.delay)&&(h.config.delay=0),angular.isUndefined(h.config.shots)&&(h.config.shots=1),angular.isUndefined(h.config.countdown)&&(h.config.countdown=0),a(),c()}function t(){Webcam.reset(),h.webcamLive=!1,h.webcamLoaded=!1}function c(){angular.isDefined(h.config.shutterUrl)&&(s=new Audio,s.autoplay=!1,navigator.userAgent.match(/Firefox/)?s.src=h.config.shutterUrl.split(".")[0]+".ogg":s.src=h.config.shutterUrl),Webcam.set({width:h.config.viewerWidth,height:h.config.viewerHeight,dest_width:h.config.outputWidth,dest_height:h.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100}),angular.isDefined(h.config.flashFallbackUrl)&&Webcam.setSWFLocation(h.config.flashFallbackUrl),angular.isDefined(h.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",h.config.flashNotDetectedText),Webcam.attach("#ng-webcam-container")}function a(){Webcam.on("load",function(){n.$apply(function(){h.webcamLoaded=!0,angular.isDefined(h.onLoad)&&h.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){h.webcamLive=!0,angular.isDefined(h.onLive)&&h.onLive()})}),Webcam.on("error",function(n){if(angular.isDefined(h.onError))return h.onError({err:n})})}function r(n){s&&s.play(),n===h.config.shots-1&&e.cancel(d),Webcam.snap(function(e){if(m[n]=e,n<h.config.shots-1&&angular.isDefined(h.onCaptureProgress)){var o=Math.round(100*(n+1)/h.config.shots);h.onCaptureProgress({src:e,progress:o})}if(n===h.config.shots-1&&angular.isDefined(h.onCaptureComplete))return h.onCaptureComplete({src:m})})}function f(){if(h.counter=3,angular.isUndefined(h.config.countdown)){var n=0;d=e(function(){r(n),n++},1e3*h.config.delay,h.config.shots)}else l=e(function(){if(--h.counter,0===h.counter){l&&e.cancel(l);var n=0;d=e(function(){r(n),n++},1e3*h.config.delay,h.config.shots)}},1e3,h.config.countdown)}function g(){Webcam.attach("#ng-webcam-container")}function u(){t()}var s,d,l,h=this,m=[];h.webcamLoaded=!1,h.webcamLive=!1,h.progress="0%",h.counter=3,h.init=i,h.destroy=t,n.$on("ngWebcam_capture",f),n.$on("ngWebcam_on",g),n.$on("ngWebcam_off",u)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"cam",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval","$window"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsIiR3aW5kb3ciLCJ2bSIsImNvbmZpZyIsImFuZ3VsYXIiLCJpc1VuZGVmaW5lZCIsInZpZXdlcldpZHRoIiwidmlld2VySGVpZ2h0Iiwib3V0cHV0V2lkdGgiLCJvdXRwdXRIZWlnaHQiLCJkZWxheSIsInNob3RzIiwiY291bnRkb3duIiwiY29uZmlndXJlTGlzdGVuZXJzIiwiY29uZmlndXJlIiwiV2ViY2FtIiwicmVzZXQiLCJ3ZWJjYW1MaXZlIiwid2ViY2FtTG9hZGVkIiwiaXNEZWZpbmVkIiwic2h1dHRlclVybCIsInNvdW5kIiwiQXVkaW8iLCJhdXRvcGxheSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwic3JjIiwic3BsaXQiLCJzZXQiLCJ3aWR0aCIsImhlaWdodCIsImRlc3Rfd2lkdGgiLCJkZXN0X2hlaWdodCIsImZvcmNlX2ZsYXNoIiwiaW1hZ2VfZm9ybWF0IiwianBlZ19xdWFsaXR5IiwiZmxhc2hGYWxsYmFja1VybCIsInNldFNXRkxvY2F0aW9uIiwiZmxhc2hOb3REZXRlY3RlZFRleHQiLCJhdHRhY2giLCJvbiIsIiRhcHBseSIsIm9uTG9hZCIsIm9uTGl2ZSIsImVyciIsIm9uRXJyb3IiLCJjYXB0dXJlIiwiaW5kZXgiLCJwbGF5IiwiY2FuY2VsIiwic25hcHNob3RUaW1lciIsInNuYXAiLCJkYXRhX3VyaSIsImltYWdlcyIsIm9uQ2FwdHVyZVByb2dyZXNzIiwicHJvZ3Jlc3MiLCJNYXRoIiwicm91bmQiLCJvbkNhcHR1cmVDb21wbGV0ZSIsIm9uV2ViY2FtQ2FwdHVyZSIsImNvdW50ZXIiLCJjb3VudCIsImNvdW50ZG93blRpbWVyIiwib25XZWJjYW1PbiIsIm9uV2ViY2FtT2ZmIiwidGhpcyIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwiYmluZFRvQ29udHJvbGxlciIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCIkaW5qZWN0IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLFlBc0JBLFNBQUFBLEtBa0JBLFFBQUFDLEdBQUFDLEVBQUFDLEdBQ0EsT0FBQSwwSUFDQSxnRkFDQSxrRUFDQSxVQUFBQyxLQUFBLElBR0EsUUFBQUMsR0FBQUMsRUFBQUosRUFBQUMsRUFBQUksR0FDQUEsRUFBQUMsT0FDQUYsRUFBQUcsSUFBQSxXQUFBLFdBQ0FGLEVBQUFHLFlBTUEsUUFBQUMsR0FBQUMsRUFBQUMsRUFBQUMsR0E2Q0EsUUFBQU4sS0FDQU8sRUFBQUMsT0FBQUQsRUFBQUMsV0FDQUMsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUcsZUFBQUosRUFBQUMsT0FBQUcsWUFBQSxRQUNBRixRQUFBQyxZQUFBSCxFQUFBQyxPQUFBSSxnQkFBQUwsRUFBQUMsT0FBQUksYUFBQSxRQUNBSCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBSyxlQUFBTixFQUFBQyxPQUFBSyxZQUFBLEtBQ0FKLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFNLGdCQUFBUCxFQUFBQyxPQUFBTSxhQUFBLEtBQ0FMLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFPLFNBQUFSLEVBQUFDLE9BQUFPLE1BQUEsR0FDQU4sUUFBQUMsWUFBQUgsRUFBQUMsT0FBQVEsU0FBQVQsRUFBQUMsT0FBQVEsTUFBQSxHQUNBUCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBUyxhQUFBVixFQUFBQyxPQUFBUyxVQUFBLEdBQ0FDLElBQ0FDLElBR0EsUUFBQWpCLEtBQ0FrQixPQUFBQyxRQUNBZCxFQUFBZSxZQUFBLEVBQ0FmLEVBQUFnQixjQUFBLEVBR0EsUUFBQUosS0FDQVYsUUFBQWUsVUFBQWpCLEVBQUFDLE9BQUFpQixjQUNBQyxFQUFBLEdBQUFDLE9BQ0FELEVBQUFFLFVBQUEsRUFDQUMsVUFBQUMs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SSxLQUFBQSxFQUNBNkUsa0JBQUEsRUFDQUMsV0FBQXhFLEVBQ0F5RSxhQUFBLE1BQ0E5RSxPQUNBVSxPQUFBLElBQ0F3RCxrQkFBQSxJQUNBYixRQUFBLElBQ0FILE9BQUEsSUFDQVksa0JBQUEsSUFDQVgsT0FBQSxLQWtOQSxPQWhNQTlDLEdBQUEwRSxTQUFBLFNBQUEsWUFBQSxXQWdNQUwsRUFyUEEvRCxRQUFBcUUsT0FBQSxnQkFBQU4sVUFBQSxXQUFBaEYsR0FDQUEsRUFBQXFGIiwiZmlsZSI6Im5nLXdlYmNhbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIGFuZ3VsYXIubW9kdWxlKCduZy13ZWJjYW0nLCBbXSkuZGlyZWN0aXZlKCduZ1dlYmNhbScsIG5nV2ViY2FtKTtcclxuICBuZ1dlYmNhbS4kaW5qZWN0ID0gW107XHJcbiAgLyoqXHJcbiAgICogIEBuZ2RvYyBEaXJlY3RpdmVcclxuICAgKiAgQG5hbWUgbmctd2ViY2FtXHJcbiAgICogIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogIERpcmVjdGl2ZSBmb3IgY2FwdHVyaW5nIGltYWdlcyBmcm9tIHlvdXIgY29tcHV0ZXIncyBjYW1lcmEsIGFuZCBkZWxpdmVyeSB0aGVuIHRvIHlvdSBhcyBkYXRhIHVyaVxyXG4gICAqXHJcbiAgICogIEB1c2FnZVxyXG4gICAqICBgYGBodG1sXHJcbiAgICogIDxuZy13ZWJjYW1cclxuICAgKiAgICBjb25maWc9XCJ2bS5jb25maWdcIlxyXG4gICAqICAgIG9uLWVycm9yPVwidm0ub25FcnJvcihlcnIpXCJcclxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxyXG4gICAqICAgIG9uLWxpdmU9XCJ2bS5vbkxpdmUoKVwiXHJcbiAgICogICAgb24tY2FwdHVyZS1wcm9ncmVzcz1cInZtLm9uQ2FwdHVyZVByb2dyZXNzKHNyYywgcHJvZ3Jlc3MpXCJcclxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxyXG4gICAqICA8L25nLXdlYmNhbT5cclxuICAgKiAgYGBgXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gbmdXZWJjYW0oKSB7XHJcbiAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsXHJcbiAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXHJcbiAgICAgIGNvbnRyb2xsZXI6IG5nV2ViY2FtQ29udHJvbGxlcixcclxuICAgICAgY29udHJvbGxlckFzOiAnY2FtJyxcclxuICAgICAgc2NvcGU6IHtcclxuICAgICAgICBjb25maWc6ICc9JyxcclxuICAgICAgICBvbkNhcHR1cmVDb21wbGV0ZTogJyYnLFxyXG4gICAgICAgIG9uRXJyb3I6ICcmJyxcclxuICAgICAgICBvbkxvYWQ6ICcmJyxcclxuICAgICAgICBvbkNhcHR1cmVQcm9ncmVzczogJyYnLFxyXG4gICAgICAgIG9uTGl2ZTogJyYnXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gdGVtcGxhdGUoZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgcmV0dXJuIFsnPGRpdiBuZy1zaG93PVwiY2FtLndlYmNhbUxpdmUgPT09IHRydWVcIiBjbGFzcz1cIm5nLXdlYmNhbVwiIG5nLWNsYXNzPVwie1xcJ25vLW92ZXJsYXlcXCcgOiBjYW0uY291bnRlciA9PT0gMCB8fCBjYW0uY29uZmlnLmNvdW50ZG93biA9PT0gMH1cIj4nLFxyXG4gICAgICAgICc8c3BhbiBuZy1zaG93PVwiY2FtLmNvbmZpZy5jb3VudGRvd24gPj0gMFwiIGlkPVwiY291bnRlclwiPnt7Y2FtLmNvdW50ZXJ9fTwvc3Bhbj4nLFxyXG4gICAgICAgICc8ZGl2IGlkPVwibmctd2ViY2FtLWNvbnRhaW5lclwiIGNsYXNzPVwibmctd2ViY2FtLWNvbnRpbmVyXCI+PC9kaXY+JyxcclxuICAgICAgICAnPC9kaXY+J10uam9pbignJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgY3RybC5pbml0KCk7XHJcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBjdHJsLmRlc3Ryb3koKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdXZWJjYW1Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckaW50ZXJ2YWwnLCAnJHdpbmRvdyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG5nV2ViY2FtQ29udHJvbGxlcigkc2NvcGUsICRpbnRlcnZhbCwgJHdpbmRvdykge1xyXG4gICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cclxuICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgdmFyIHNvdW5kLCBzbmFwc2hvdFRpbWVyLCBjb3VudGRvd25UaW1lcjtcclxuICAgICAgdmFyIGltYWdlcyA9IFtdO1xyXG4gICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcclxuICAgICAgdm0ud2ViY2FtTGl2ZSA9IGZhbHNlO1xyXG4gICAgICB2bS5wcm9ncmVzcyA9ICcwJSc7XHJcbiAgICAgIHZtLmNvdW50ZXIgPSAzO1xyXG4gICAgICB2bS5pbml0ID0gaW5pdDtcclxuICAgICAgdm0uZGVzdHJveSA9IGRlc3Ryb3k7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXHJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9jYXB0dXJlXHJcbiAgICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAgICpcclxuICAgICAgICogIExpc3RlbmVyIGZvciBjYXB0dXJlIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fY2FwdHVyZScpO2BcclxuICAgICAgICovXHJcbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX2NhcHR1cmUnLCBvbldlYmNhbUNhcHR1cmUpO1xyXG4gICAgICAvKipcclxuICAgICAgICogIEBuZ2RvYyBsaXN0ZW5lclxyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb25cclxuICAgICAgICogIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvbiB1c2VyIGFjdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgQHVzYWdlXHJcbiAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX29uJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fb24nLCBvbldlYmNhbU9uKTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcclxuICAgICAgICogIEBuYW1lIG5nV2ViY2FtX29mZlxyXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9mZiB1c2VyIGFjdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgQHVzYWdlXHJcbiAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX29mZicpO2BcclxuICAgICAgICovXHJcbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29mZicsIG9uV2ViY2FtT2ZmKTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgdm0uY29uZmlnID0gdm0uY29uZmlnIHx8IHt9O1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnZpZXdlcldpZHRoKSkgdm0uY29uZmlnLnZpZXdlcldpZHRoID0gJ2F1dG8nO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnZpZXdlckhlaWdodCkpIHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0V2lkdGgpKSB2bS5jb25maWcub3V0cHV0V2lkdGggPSAzMjA7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0SGVpZ2h0KSkgdm0uY29uZmlnLm91dHB1dEhlaWdodCA9IDI0MDtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5kZWxheSkpIHZtLmNvbmZpZy5kZWxheSA9IDA7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuc2hvdHMpKSB2bS5jb25maWcuc2hvdHMgPSAxO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmNvdW50ZG93bikpIHZtLmNvbmZpZy5jb3VudGRvd24gPSAwO1xyXG4gICAgICAgIGNvbmZpZ3VyZUxpc3RlbmVycygpO1xyXG4gICAgICAgIGNvbmZpZ3VyZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBkZXN0cm95KCkge1xyXG4gICAgICAgIFdlYmNhbS5yZXNldCgpO1xyXG4gICAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcclxuICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlKCkge1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5zaHV0dGVyVXJsKSkge1xyXG4gICAgICAgICAgc291bmQgPSBuZXcgQXVkaW8oKTtcclxuICAgICAgICAgIHNvdW5kLmF1dG9wbGF5ID0gZmFsc2U7XHJcbiAgICAgICAgICBpZihuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9GaXJlZm94LykpIHtcclxuICAgICAgICAgICAgc291bmQuc3JjID0gdm0uY29uZmlnLnNodXR0ZXJVcmwuc3BsaXQoJy4nKVswXSArICcub2dnJztcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBXZWJjYW0uc2V0KHtcclxuICAgICAgICAgIHdpZHRoOiB2bS5jb25maWcudmlld2VyV2lkdGgsXHJcbiAgICAgICAgICBoZWlnaHQ6IHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQsXHJcbiAgICAgICAgICBkZXN0X3dpZHRoOiB2bS5jb25maWcub3V0cHV0V2lkdGgsXHJcbiAgICAgICAgICBkZXN0X2hlaWdodDogdm0uY29uZmlnLm91dHB1dEhlaWdodCxcclxuICAgICAgICAgIGZvcmNlX2ZsYXNoOiBmYWxzZSxcclxuICAgICAgICAgIGltYWdlX2Zvcm1hdDogJ2pwZWcnLFxyXG4gICAgICAgICAganBlZ19xdWFsaXR5OiAxMDBcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCkpIHtcclxuICAgICAgICAgIFdlYmNhbS5zZXRTV0ZMb2NhdGlvbih2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaE5vdERldGVjdGVkVGV4dCkpIHtcclxuICAgICAgICAgIFdlYmNhbS5zZXQoJ2ZsYXNoTm90RGV0ZWN0ZWRUZXh0Jywgdm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlTGlzdGVuZXJzKCkge1xyXG4gICAgICAgIFdlYmNhbS5vbignbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdm0ud2ViY2FtTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ub25Mb2FkKSkge1xyXG4gICAgICAgICAgICAgIHZtLm9uTG9hZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBXZWJjYW0ub24oJ2xpdmUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZtLndlYmNhbUxpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxpdmUpKSB7XHJcbiAgICAgICAgICAgICAgdm0ub25MaXZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFdlYmNhbS5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uRXJyb3IpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5vbkVycm9yKHtlcnI6ZXJyfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNhcHR1cmUoaW5kZXgpIHtcclxuICAgICAgICBpZihzb3VuZCkge1xyXG4gICAgICAgICAgc291bmQucGxheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSkge1xyXG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChzbmFwc2hvdFRpbWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLnNuYXAoZnVuY3Rpb24oZGF0YV91cmkpIHtcclxuICAgICAgICAgIGltYWdlc1tpbmRleF0gPSBkYXRhX3VyaTtcclxuICAgICAgICAgIGlmKGluZGV4IDwgKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVQcm9ncmVzcykpIHtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZCgoKGluZGV4KzEpICogMTAwKSAvIHZtLmNvbmZpZy5zaG90cyk7XHJcbiAgICAgICAgICAgIHZtLm9uQ2FwdHVyZVByb2dyZXNzKHtzcmM6IGRhdGFfdXJpLHByb2dyZXNzOiBwcm9ncmVzc30pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkgJiYgYW5ndWxhci5pc0RlZmluZWQodm0ub25DYXB0dXJlQ29tcGxldGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5vbkNhcHR1cmVDb21wbGV0ZSh7c3JjOiBpbWFnZXN9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1DYXB0dXJlKCkge1xyXG4gICAgICAgIHZtLmNvdW50ZXIgPSAzO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmNvdW50ZG93bikpIHtcclxuICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcclxuICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY291bnRkb3duVGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC0tdm0uY291bnRlcjtcclxuICAgICAgICAgICAgaWYodm0uY291bnRlciA9PT0gMCkge1xyXG4gICAgICAgICAgICAgIGlmKGNvdW50ZG93blRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGNvdW50ZG93blRpbWVyKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY2FwdHVyZShjb3VudCk7XHJcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSwgMTAwMCwgdm0uY29uZmlnLmNvdW50ZG93bik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbU9uKCkge1xyXG4gICAgICAgIFdlYmNhbS5hdHRhY2goJyNuZy13ZWJjYW0tY29udGFpbmVyJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIG9uV2ViY2FtT2ZmKCkge1xyXG4gICAgICAgIGRlc3Ryb3koKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gaGFzVXNlck1lZGlhKCkge1xyXG4gICAgICAgIHJldHVybiAoJHdpbmRvdy5uYXZpZ2F0b3IuZ2V0VXNlck1lZGlhIHx8ICR3aW5kb3cubmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSB8fFxyXG4gICAgICAgICR3aW5kb3cubmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYSB8fCAkd2luZG93Lm5hdmlnYXRvci5tc0dldFVzZXJNZWRpYSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGJyb3dzZXJzKCkge1xyXG4gICAgICAgIC8qanNoaW50IG1heGNvbXBsZXhpdHk6IDQwICovXHJcbiAgICAgICAgdmFyIHVhPSAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQsIHRlbSxcclxuICAgICAgICAgIE09IHVhLm1hdGNoKC8ob3BlcmF8Y2hyb21lfHNhZmFyaXxmaXJlZm94fG1zaWV8dHJpZGVudCg/PVxcLykpXFwvP1xccyooXFxkKykvaSkgfHwgW107XHJcbiAgICAgICAgaWYoL3RyaWRlbnQvaS50ZXN0KE1bMV0pKXtcclxuICAgICAgICAgIHRlbT0gIC9cXGJydlsgOl0rKFxcZCspL2cuZXhlYyh1YSkgfHwgW107XHJcbiAgICAgICAgICByZXR1cm4gJ0lFICcrKHRlbVsxXSB8fCAnJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKE1bMV09PT0gJ0Nocm9tZScpe1xyXG4gICAgICAgICAgdGVtPSB1YS5tYXRjaCgvXFxiKE9QUnxFZGdlKVxcLyhcXGQrKS8pO1xyXG4gICAgICAgICAgaWYodGVtIT0gbnVsbCkgcmV0dXJuIHRlbS5zbGljZSgxKS5qb2luKCcgJykucmVwbGFjZSgnT1BSJywgJ09wZXJhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE09IE1bMl0/IFtNWzFdLCBNWzJdXTogW25hdmlnYXRvci5hcHBOYW1lLCBuYXZpZ2F0b3IuYXBwVmVyc2lvbiwgJy0/J107XHJcbiAgICAgICAgaWYoKHRlbT0gdWEubWF0Y2goL3ZlcnNpb25cXC8oXFxkKykvaSkpIT0gbnVsbCkgTS5zcGxpY2UoMSwgMSwgdGVtWzFdKTtcclxuICAgICAgICByZXR1cm4gTS5qb2luKCcgJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBkaXJlY3RpdmU7XHJcbiAgfVxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
