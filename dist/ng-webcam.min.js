!function(){"use strict";function n(){function n(n,e){return['<div ng-show="vm.webcamLive === true" class="ng-webcam" ng-class="{\'no-overlay\' : vm.counter === 0 || vm.config.countdown === 0}">','<span ng-show="vm.config.countdown >= 0" id="ng-webcam-counter">{{vm.counter}}</span>','<img id="ng-webcam-overlay" src="{{vm.config.overlay}}" />','<div id="ng-webcam-container"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)&&(l.config.countdown=0),c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=3}function t(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:!0}),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){console.log("error.webcamjs = ",n),angular.isDefined(l.onError)&&l.onError({err:n})})}function a(n){u&&u.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(m[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:m})})}function r(){if(angular.isUndefined(l.config.countdown)){var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}else{if(void 0!==d)return;l.counter=3,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d);var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}},1e3,3)}}function f(){Webcam.attach("#ng-webcam-container")}function g(){i()}var u,s,d,l=this,m=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=3,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",g)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"vm",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwiYW5ndWxhciIsImlzVW5kZWZpbmVkIiwidmlld2VyV2lkdGgiLCJ2aWV3ZXJIZWlnaHQiLCJvdXRwdXRXaWR0aCIsIm91dHB1dEhlaWdodCIsImRlbGF5Iiwic2hvdHMiLCJjb3VudGRvd24iLCJjb25maWd1cmVMaXN0ZW5lcnMiLCJjb25maWd1cmUiLCJ3ZWJjYW1MaXZlIiwiV2ViY2FtIiwicmVzZXQiLCJ3ZWJjYW1Mb2FkZWQiLCJpc0RlZmluZWQiLCJzbmFwc2hvdFRpbWVyIiwiY2FuY2VsIiwidW5kZWZpbmVkIiwiY291bnRkb3duVGltZXIiLCJjb3VudGVyIiwic2h1dHRlclVybCIsInNvdW5kIiwiQXVkaW8iLCJhdXRvcGxheSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwic3JjIiwic3BsaXQiLCJzZXQiLCJ3aWR0aCIsImhlaWdodCIsImRlc3Rfd2lkdGgiLCJkZXN0X2hlaWdodCIsImZvcmNlX2ZsYXNoIiwiaW1hZ2VfZm9ybWF0IiwianBlZ19xdWFsaXR5IiwiZmxpcF9ob3JpeiIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImZsYXNoTm90RGV0ZWN0ZWRUZXh0IiwiYXR0YWNoIiwib24iLCIkYXBwbHkiLCJvbkxvYWQiLCJvbkxpdmUiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwib25FcnJvciIsImNhcHR1cmUiLCJpbmRleCIsInBsYXkiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXNCQSxTQUFBQSxLQWtCQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLE9BQUEsdUlBQ0Esd0ZBQ0EsNkRBQ0EsdUNBQ0EsVUFBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFKLEVBQUFDLEVBQUFJLEdBQ0FBLEVBQUFDLE9BQ0FGLEVBQUFHLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEdBNENBLFFBQUFMLEtBQ0FNLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFHLGVBQUFKLEVBQUFDLE9BQUFHLFlBQUEsUUFDQUYsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUksZ0JBQUFMLEVBQUFDLE9BQUFJLGFBQUEsUUFDQUgsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUssZUFBQU4sRUFBQUMsT0FBQUssWUFBQSxLQUNBSixRQUFBQyxZQUFBSCxFQUFBQyxPQUFBTSxnQkFBQVAsRUFBQUMsT0FBQU0sYUFBQSxLQUNBTCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBTyxTQUFBUixFQUFBQyxPQUFBTyxNQUFBLEdBQ0FOLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFRLFNBQUFULEVBQUFDLE9BQUFRLE1BQUEsR0FDQVAsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQVMsYUFBQVYsRUFBQUMsT0FBQVMsVUFBQSxHQUNBQyxJQUNBQyxJQUdBLFFBQUFoQixLQUNBSSxFQUFBYSxZQUFBQyxPQUFBQyxRQUNBZixFQUFBYSxZQUFBLEVBQ0FiLEVBQUFnQixjQUFBLEVBQ0FkLFFBQUFlLFVBQUFDLEtBQ0FuQixFQUFBb0IsT0FBQUQsR0FDQUEsRUFB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MUQsR0FBQWdCLGNBQUEsRUFDQWhCLEVBQUFhLFlBQUEsRUFDQWIsRUFBQXNCLFFBQUEsRUFDQXRCLEVBQUFOLEtBQUFBLEVBQ0FNLEVBQUFKLFFBQUFBLEVBV0FFLEVBQUFILElBQUEsbUJBQUFxRSxHQVdBbEUsRUFBQUgsSUFBQSxjQUFBdUUsR0FXQXBFLEVBQUFILElBQUEsZUFBQXdFLEdBNUVBLEdBQUFFLElBQ0FDLFNBQUEsSUFDQW5GLFNBQUFBLEVBQ0FJLEtBQUFBLEVBQ0FnRixrQkFBQSxFQUNBQyxXQUFBM0UsRUFDQTRFLGFBQUEsS0FDQWpGLE9BQ0FTLE9BQUEsSUFDQThELGtCQUFBLElBQ0FYLFFBQUEsSUFDQUwsT0FBQSxJQUNBWSxrQkFBQSxJQUNBWCxPQUFBLEtBeU1BLE9BdExBbkQsR0FBQTZFLFNBQUEsU0FBQSxhQXNMQUwsRUE1T0FuRSxRQUFBeUUsT0FBQSxnQkFBQU4sVUFBQSxXQUFBbkYsR0FDQUEsRUFBQXdGIiwiZmlsZSI6Im5nLXdlYmNhbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIGFuZ3VsYXIubW9kdWxlKCduZy13ZWJjYW0nLCBbXSkuZGlyZWN0aXZlKCduZ1dlYmNhbScsIG5nV2ViY2FtKTtcclxuICBuZ1dlYmNhbS4kaW5qZWN0ID0gW107XHJcbiAgLyoqXHJcbiAgICogIEBuZ2RvYyBEaXJlY3RpdmVcclxuICAgKiAgQG5hbWUgbmctd2ViY2FtXHJcbiAgICogIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogIERpcmVjdGl2ZSBmb3IgY2FwdHVyaW5nIGltYWdlcyBmcm9tIHlvdXIgY29tcHV0ZXIncyBjYW1lcmEsIGFuZCBkZWxpdmVyeSB0aGVuIHRvIHlvdSBhcyBkYXRhIHVyaVxyXG4gICAqXHJcbiAgICogIEB1c2FnZVxyXG4gICAqICBgYGBodG1sXHJcbiAgICogIDxuZy13ZWJjYW1cclxuICAgKiAgICBjb25maWc9XCJ2bS5jb25maWdcIlxyXG4gICAqICAgIG9uLWVycm9yPVwidm0ub25FcnJvcihlcnIpXCJcclxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxyXG4gICAqICAgIG9uLWxpdmU9XCJ2bS5vbkxpdmUoKVwiXHJcbiAgICogICAgb24tY2FwdHVyZS1wcm9ncmVzcz1cInZtLm9uQ2FwdHVyZVByb2dyZXNzKHNyYywgcHJvZ3Jlc3MpXCJcclxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxyXG4gICAqICA8L25nLXdlYmNhbT5cclxuICAgKiAgYGBgXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gbmdXZWJjYW0oKSB7XHJcbiAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsXHJcbiAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXHJcbiAgICAgIGNvbnRyb2xsZXI6IG5nV2ViY2FtQ29udHJvbGxlcixcclxuICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICBzY29wZToge1xyXG4gICAgICAgIGNvbmZpZzogJz0nLFxyXG4gICAgICAgIG9uQ2FwdHVyZUNvbXBsZXRlOiAnJicsXHJcbiAgICAgICAgb25FcnJvcjogJyYnLFxyXG4gICAgICAgIG9uTG9hZDogJyYnLFxyXG4gICAgICAgIG9uQ2FwdHVyZVByb2dyZXNzOiAnJicsXHJcbiAgICAgICAgb25MaXZlOiAnJidcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiB0ZW1wbGF0ZShlbGVtZW50LCBhdHRycykge1xyXG4gICAgICByZXR1cm4gWyc8ZGl2IG5nLXNob3c9XCJ2bS53ZWJjYW1MaXZlID09PSB0cnVlXCIgY2xhc3M9XCJuZy13ZWJjYW1cIiBuZy1jbGFzcz1cIntcXCduby1vdmVybGF5XFwnIDogdm0uY291bnRlciA9PT0gMCB8fCB2bS5jb25maWcuY291bnRkb3duID09PSAwfVwiPicsXHJcbiAgICAgICAgJzxzcGFuIG5nLXNob3c9XCJ2bS5jb25maWcuY291bnRkb3duID49IDBcIiBpZD1cIm5nLXdlYmNhbS1jb3VudGVyXCI+e3t2bS5jb3VudGVyfX08L3NwYW4+JyxcclxuICAgICAgICAnPGltZyBpZD1cIm5nLXdlYmNhbS1vdmVybGF5XCIgc3JjPVwie3t2bS5jb25maWcub3ZlcmxheX19XCIgLz4nLFxyXG4gICAgICAgICc8ZGl2IGlkPVwibmctd2ViY2FtLWNvbnRhaW5lclwiPjwvZGl2PicsXHJcbiAgICAgICAgJzwvZGl2PiddLmpvaW4oJycpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgIGN0cmwuaW5pdCgpO1xyXG4gICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY3RybC5kZXN0cm95KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nV2ViY2FtQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGludGVydmFsJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbmdXZWJjYW1Db250cm9sbGVyKCRzY29wZSwgJGludGVydmFsKSB7XHJcbiAgICAgIC8qanNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xyXG4gICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICB2YXIgc291bmQsIHNuYXBzaG90VGltZXIsIGNvdW50ZG93blRpbWVyO1xyXG4gICAgICB2YXIgaW1hZ2VzID0gW107XHJcbiAgICAgIHZtLndlYmNhbUxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XHJcbiAgICAgIHZtLmNvdW50ZXIgPSAzO1xyXG4gICAgICB2bS5pbml0ID0gaW5pdDtcclxuICAgICAgdm0uZGVzdHJveSA9IGRlc3Ryb3k7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXHJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9jYXB0dXJlXHJcbiAgICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAgICpcclxuICAgICAgICogIExpc3RlbmVyIGZvciBjYXB0dXJlIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fY2FwdHVyZScpO2BcclxuICAgICAgICovXHJcbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX2NhcHR1cmUnLCBvbldlYmNhbUNhcHR1cmUpO1xyXG4gICAgICAvKipcclxuICAgICAgICogIEBuZ2RvYyBsaXN0ZW5lclxyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb25cclxuICAgICAgICogIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvbiB1c2VyIGFjdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgQHVzYWdlXHJcbiAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX29uJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fb24nLCBvbldlYmNhbU9uKTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcclxuICAgICAgICogIEBuYW1lIG5nV2ViY2FtX29mZlxyXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9mZiB1c2VyIGFjdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgQHVzYWdlXHJcbiAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX29mZicpO2BcclxuICAgICAgICovXHJcbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29mZicsIG9uV2ViY2FtT2ZmKTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgdm0uY29uZmlnID0gdm0uY29uZmlnIHx8IHt9O1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnZpZXdlcldpZHRoKSkgdm0uY29uZmlnLnZpZXdlcldpZHRoID0gJ2F1dG8nO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnZpZXdlckhlaWdodCkpIHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0V2lkdGgpKSB2bS5jb25maWcub3V0cHV0V2lkdGggPSAzMjA7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0SGVpZ2h0KSkgdm0uY29uZmlnLm91dHB1dEhlaWdodCA9IDI0MDtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5kZWxheSkpIHZtLmNvbmZpZy5kZWxheSA9IDA7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuc2hvdHMpKSB2bS5jb25maWcuc2hvdHMgPSAxO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmNvdW50ZG93bikpIHZtLmNvbmZpZy5jb3VudGRvd24gPSAwO1xyXG4gICAgICAgIGNvbmZpZ3VyZUxpc3RlbmVycygpO1xyXG4gICAgICAgIGNvbmZpZ3VyZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBkZXN0cm95KCkge1xyXG4gICAgICAgIGlmKHZtLndlYmNhbUxpdmUpIFdlYmNhbS5yZXNldCgpO1xyXG4gICAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcclxuICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZChzbmFwc2hvdFRpbWVyKSkge1xyXG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChzbmFwc2hvdFRpbWVyKTtcclxuICAgICAgICAgIHNuYXBzaG90VGltZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKGNvdW50ZG93blRpbWVyKSkge1xyXG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChjb3VudGRvd25UaW1lcik7XHJcbiAgICAgICAgICBjb3VudGRvd25UaW1lciA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uY291bnRlciA9IDM7XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBjb25maWd1cmUoKSB7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLnNodXR0ZXJVcmwpKSB7XHJcbiAgICAgICAgICBzb3VuZCA9IG5ldyBBdWRpbygpO1xyXG4gICAgICAgICAgc291bmQuYXV0b3BsYXkgPSBmYWxzZTtcclxuICAgICAgICAgIGlmKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0ZpcmVmb3gvKSkge1xyXG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybC5zcGxpdCgnLicpWzBdICsgJy5vZ2cnO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc291bmQuc3JjID0gdm0uY29uZmlnLnNodXR0ZXJVcmw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFdlYmNhbS5zZXQoe1xyXG4gICAgICAgICAgd2lkdGg6IHZtLmNvbmZpZy52aWV3ZXJXaWR0aCxcclxuICAgICAgICAgIGhlaWdodDogdm0uY29uZmlnLnZpZXdlckhlaWdodCxcclxuICAgICAgICAgIGRlc3Rfd2lkdGg6IHZtLmNvbmZpZy5vdXRwdXRXaWR0aCxcclxuICAgICAgICAgIGRlc3RfaGVpZ2h0OiB2bS5jb25maWcub3V0cHV0SGVpZ2h0LFxyXG4gICAgICAgICAgZm9yY2VfZmxhc2g6IGZhbHNlLFxyXG4gICAgICAgICAgaW1hZ2VfZm9ybWF0OiAnanBlZycsXHJcbiAgICAgICAgICBqcGVnX3F1YWxpdHk6IDEwMCxcclxuICAgICAgICAgIGZsaXBfaG9yaXo6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCkpIHtcclxuICAgICAgICAgIFdlYmNhbS5zZXRTV0ZMb2NhdGlvbih2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaE5vdERldGVjdGVkVGV4dCkpIHtcclxuICAgICAgICAgIFdlYmNhbS5zZXQoJ2ZsYXNoTm90RGV0ZWN0ZWRUZXh0Jywgdm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlTGlzdGVuZXJzKCkge1xyXG4gICAgICAgIFdlYmNhbS5vbignbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdm0ud2ViY2FtTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ub25Mb2FkKSkge1xyXG4gICAgICAgICAgICAgIHZtLm9uTG9hZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBXZWJjYW0ub24oJ2xpdmUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZtLndlYmNhbUxpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxpdmUpKSB7XHJcbiAgICAgICAgICAgICAgdm0ub25MaXZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFdlYmNhbS5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvci53ZWJjYW1qcyA9ICcsIGVycik7XHJcbiAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkVycm9yKSkge1xyXG4gICAgICAgICAgICB2bS5vbkVycm9yKHtlcnI6ZXJyfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNhcHR1cmUoaW5kZXgpIHtcclxuICAgICAgICBpZihzb3VuZCkge1xyXG4gICAgICAgICAgc291bmQucGxheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSkge1xyXG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChzbmFwc2hvdFRpbWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLnNuYXAoZnVuY3Rpb24oZGF0YV91cmkpIHtcclxuICAgICAgICAgIGltYWdlc1tpbmRleF0gPSBkYXRhX3VyaTtcclxuICAgICAgICAgIGlmKGluZGV4IDwgKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVQcm9ncmVzcykpIHtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZCgoKGluZGV4KzEpICogMTAwKSAvIHZtLmNvbmZpZy5zaG90cyk7XHJcbiAgICAgICAgICAgIHZtLm9uQ2FwdHVyZVByb2dyZXNzKHtzcmM6IGRhdGFfdXJpLHByb2dyZXNzOiBwcm9ncmVzc30pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkgJiYgYW5ndWxhci5pc0RlZmluZWQodm0ub25DYXB0dXJlQ29tcGxldGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5vbkNhcHR1cmVDb21wbGV0ZSh7c3JjOiBpbWFnZXN9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1DYXB0dXJlKCkge1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmNvdW50ZG93bikpIHtcclxuICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcclxuICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaWYoY291bnRkb3duVGltZXIgIT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgdm0uY291bnRlciA9IDM7XHJcbiAgICAgICAgICBjb3VudGRvd25UaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdm0uY291bnRlciA9IHZtLmNvdW50ZXIgLSAxO1xyXG4gICAgICAgICAgICBpZih2bS5jb3VudGVyID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgaWYoY291bnRkb3duVGltZXIpIHtcclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY291bnRkb3duVGltZXIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgIHNuYXBzaG90VGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgfSwgKHZtLmNvbmZpZy5kZWxheSAqIDEwMDApLCB2bS5jb25maWcuc2hvdHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LCAxMDAwLCAzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIG9uV2ViY2FtT24oKSB7XHJcbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PZmYoKSB7XHJcbiAgICAgICAgZGVzdHJveSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG4gIH1cclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
