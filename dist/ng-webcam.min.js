!function(){"use strict";function n(n){function e(){return['<div class="ng-webcam">','<div id="ng-webcam-container"></div>'].join("")}function o(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function i(n,e,o,i){function t(){m.config=m.config||{},angular.isUndefined(m.config.viewerWidth)&&(m.config.viewerWidth="auto"),angular.isUndefined(m.config.viewerHeight)&&(m.config.viewerHeight="auto"),angular.isUndefined(m.config.outputWidth)&&(m.config.outputWidth=320),angular.isUndefined(m.config.outputHeight)&&(m.config.outputHeight=240),angular.isUndefined(m.config.delay)&&(m.config.delay=0),angular.isUndefined(m.config.shots)&&(m.config.shots=1),r(),c()}function a(){Webcam.reset(),m.webcamLive=!1,m.webcamLoaded=!1}function c(){angular.isDefined(m.config.shutterUrl)&&(l=new Audio,l.autoplay=!1,navigator.userAgent.match(/Firefox/)?l.src=m.config.shutterUrl.split(".")[0]+".ogg":l.src=m.config.shutterUrl),Webcam.set({width:m.config.viewerWidth,height:m.config.viewerHeight,dest_width:m.config.outputWidth,dest_height:m.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100}),angular.isDefined(m.config.flashFallbackUrl)&&Webcam.setSWFLocation(m.config.flashFallbackUrl),angular.isDefined(m.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",m.config.flashNotDetectedText),Webcam.attach("#ng-webcam-container")}function r(){Webcam.on("load",function(){n.$apply(function(){m.webcamLoaded=!0,angular.isDefined(m.onLoad)&&m.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){m.webcamLive=!0,angular.isDefined(m.onLive)&&m.onLive()})}),Webcam.on("error",function(n){if(angular.isDefined(m.onError))return m.onError({err:n})})}function g(n){l&&l.play(),n===m.config.shots-1&&e.cancel(d),Webcam.snap(function(e){if(h[n]=e,n<m.config.shots-1&&angular.isDefined(m.onCaptureProgress)){var o=Math.round(100*(n+1)/m.config.shots);m.onCaptureProgress({src:e,progress:o})}if(n===m.config.shots-1&&angular.isDefined(m.onCaptureComplete))return m.onCaptureComplete({src:h})})}function f(n){o.debug("ngWebcamController.onWebcamCapture(event) : ",n);var i=0;d=e(function(){g(i),i++},1e3*m.config.delay,m.config.shots)}function u(n){o.debug("ngWebcamController.onWebcamOn(event) : ",n),Webcam.attach("#ng-webcam-container")}function s(n){o.debug("ngWebcamController.onWebcamOff(event) : ",n),a()}var l,d,m=this,h=[];m.webcamLoaded=!1,m.webcamLive=!1,m.progress="0%",m.init=t,m.destroy=a,n.$on("ngWebcam_capture",f),n.$on("ngWebcam_on",u),n.$on("ngWebcam_off",s)}var t={restrict:"E",template:e,link:o,bindToController:!0,controller:i,controllerAs:"cam",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return i.$inject=["$scope","$interval","$log","$window"],t}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=["$log"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsIiRsb2ciLCJ0ZW1wbGF0ZSIsImpvaW4iLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCJjdHJsIiwiaW5pdCIsIiRvbiIsImRlc3Ryb3kiLCJuZ1dlYmNhbUNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkaW50ZXJ2YWwiLCIkd2luZG93Iiwidm0iLCJjb25maWciLCJhbmd1bGFyIiwiaXNVbmRlZmluZWQiLCJ2aWV3ZXJXaWR0aCIsInZpZXdlckhlaWdodCIsIm91dHB1dFdpZHRoIiwib3V0cHV0SGVpZ2h0IiwiZGVsYXkiLCJzaG90cyIsImNvbmZpZ3VyZUxpc3RlbmVycyIsImNvbmZpZ3VyZSIsIldlYmNhbSIsInJlc2V0Iiwid2ViY2FtTGl2ZSIsIndlYmNhbUxvYWRlZCIsImlzRGVmaW5lZCIsInNodXR0ZXJVcmwiLCJzb3VuZCIsIkF1ZGlvIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJtYXRjaCIsInNyYyIsInNwbGl0Iiwic2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0X3dpZHRoIiwiZGVzdF9oZWlnaHQiLCJmb3JjZV9mbGFzaCIsImltYWdlX2Zvcm1hdCIsImpwZWdfcXVhbGl0eSIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImZsYXNoTm90RGV0ZWN0ZWRUZXh0IiwiYXR0YWNoIiwib24iLCIkYXBwbHkiLCJvbkxvYWQiLCJvbkxpdmUiLCJlcnIiLCJvbkVycm9yIiwiY2FwdHVyZSIsImluZGV4IiwicGxheSIsImNhbmNlbCIsInRpbWVyIiwic25hcCIsImRhdGFfdXJpIiwiaW1hZ2VzIiwib25DYXB0dXJlUHJvZ3Jlc3MiLCJwcm9ncmVzcyIsIk1hdGgiLCJyb3VuZCIsIm9uQ2FwdHVyZUNvbXBsZXRlIiwib25XZWJjYW1DYXB0dXJlIiwiZXZlbnQiLCJkZWJ1ZyIsImNvdW50Iiwib25XZWJjYW1PbiIsIm9uV2ViY2FtT2ZmIiwidGhpcyIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwiYmluZFRvQ29udHJvbGxlciIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCIkaW5qZWN0IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLFlBc0JBLFNBQUFBLEdBQUFDLEdBa0JBLFFBQUFDLEtBQ0EsT0FBQSwwQkFDQSx3Q0FBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FBLEVBQUFDLE9BQ0FKLEVBQUFLLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEVBQUFiLEVBQUFjLEdBNENBLFFBQUFOLEtBQ0FPLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFHLGVBQUFKLEVBQUFDLE9BQUFHLFlBQUEsUUFDQUYsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUksZ0JBQUFMLEVBQUFDLE9BQUFJLGFBQUEsUUFDQUgsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUssZUFBQU4sRUFBQUMsT0FBQUssWUFBQSxLQUNBSixRQUFBQyxZQUFBSCxFQUFBQyxPQUFBTSxnQkFBQVAsRUFBQUMsT0FBQU0sYUFBQSxLQUNBTCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBTyxTQUFBUixFQUFBQyxPQUFBTyxNQUFBLEdBQ0FOLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFRLFNBQUFULEVBQUFDLE9BQUFRLE1BQUEsR0FDQUMsSUFDQUMsSUFHQSxRQUFBaEIsS0FDQWlCLE9BQUFDLFFBQ0FiLEVBQUFjLFlBQUEsRUFDQWQsRUFBQWUsY0FBQSxFQUdBLFFBQUFKLEtBQ0FULFFBQUFjLFVBQUFoQixFQUFBQyxPQUFBZ0IsY0FDQUMsRUFBQSxHQUFBQyxPQUNBRCxFQUFBRSxVQUFBLEVBQ0FDLFVBQUFDLFVBQUFDLE1BQUEsV0FDQUwsRUFBQU0sSUFBQXhCLEVBQUFDLE9BQUFnQixXQUFBUSxNQUFBLEtBQUEsR0FBQSxPQUVBUCxFQUFBTSxJQUFBeEIsRUFBQUMs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XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhci5tb2R1bGUoJ25nLXdlYmNhbScsIFtdKS5kaXJlY3RpdmUoJ25nV2ViY2FtJywgbmdXZWJjYW0pO1xuICBuZ1dlYmNhbS4kaW5qZWN0ID0gWyckbG9nJ107XG4gIC8qKlxuICAgKiAgQG5nZG9jIERpcmVjdGl2ZVxuICAgKiAgQG5hbWUgbmctd2ViY2FtXG4gICAqICBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogIERpcmVjdGl2ZSBmb3IgY2FwdHVyaW5nIGltYWdlcyBmcm9tIHlvdXIgY29tcHV0ZXIncyBjYW1lcmEsIGFuZCBkZWxpdmVyeSB0aGVuIHRvIHlvdSBhcyBkYXRhIHVyaVxuICAgKlxuICAgKiAgQHVzYWdlXG4gICAqICBgYGBodG1sXG4gICAqICA8bmctd2ViY2FtXG4gICAqICAgIGNvbmZpZz1cInZtLmNvbmZpZ1wiXG4gICAqICAgIG9uLWVycm9yPVwidm0ub25FcnJvcihlcnIpXCJcbiAgICogICAgb24tbG9hZD1cInZtLm9uTG9hZCgpXCJcbiAgICogICAgb24tbGl2ZT1cInZtLm9uTGl2ZSgpXCJcbiAgICogICAgb24tY2FwdHVyZS1wcm9ncmVzcz1cInZtLm9uQ2FwdHVyZVByb2dyZXNzKHNyYywgcHJvZ3Jlc3MpXCJcbiAgICogICAgb24tY2FwdHVyZS1jb21wbGV0ZT1cInZtLm9uQ2FwdHVyZUNvbXBsZXRlKHNyYylcIj5cbiAgICogIDwvbmctd2ViY2FtPlxuICAgKiAgYGBgXG4gICAqL1xuICBmdW5jdGlvbiBuZ1dlYmNhbSgkbG9nKSB7XG4gICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsXG4gICAgICBsaW5rOiBsaW5rLFxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXI6IG5nV2ViY2FtQ29udHJvbGxlcixcbiAgICAgIGNvbnRyb2xsZXJBczogJ2NhbScsXG4gICAgICBzY29wZToge1xuICAgICAgICBjb25maWc6ICc9JyxcbiAgICAgICAgb25DYXB0dXJlQ29tcGxldGU6ICcmJyxcbiAgICAgICAgb25FcnJvcjogJyYnLFxuICAgICAgICBvbkxvYWQ6ICcmJyxcbiAgICAgICAgb25DYXB0dXJlUHJvZ3Jlc3M6ICcmJyxcbiAgICAgICAgb25MaXZlOiAnJidcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdGVtcGxhdGUoKSB7XG4gICAgICByZXR1cm4gWyc8ZGl2IGNsYXNzPVwibmctd2ViY2FtXCI+JyxcbiAgICAgICAgJzxkaXYgaWQ9XCJuZy13ZWJjYW0tY29udGFpbmVyXCI+PC9kaXY+J10uam9pbignJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcbiAgICAgIGN0cmwuaW5pdCgpO1xuICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjdHJsLmRlc3Ryb3koKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nV2ViY2FtQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGludGVydmFsJywgJyRsb2cnLCAnJHdpbmRvdyddO1xuXG4gICAgZnVuY3Rpb24gbmdXZWJjYW1Db250cm9sbGVyKCRzY29wZSwgJGludGVydmFsLCAkbG9nLCAkd2luZG93KSB7XG4gICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2YXIgc291bmQsIHRpbWVyO1xuICAgICAgdmFyIGltYWdlcyA9IFtdO1xuICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XG4gICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XG4gICAgICB2bS5wcm9ncmVzcyA9ICcwJSc7XG4gICAgICB2bS5pbml0ID0gaW5pdDtcbiAgICAgIHZtLmRlc3Ryb3kgPSBkZXN0cm95O1xuICAgICAgLyoqXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fY2FwdHVyZVxuICAgICAgICogIEBkZXNjcmlwdGlvblxuICAgICAgICpcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FwdHVyZSB1c2VyIGFjdGlvblxuICAgICAgICpcbiAgICAgICAqICBAdXNhZ2VcbiAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX2NhcHR1cmUnKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX2NhcHR1cmUnLCBvbldlYmNhbUNhcHR1cmUpO1xuICAgICAgLyoqXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb25cbiAgICAgICAqICBAZGVzY3JpcHRpb25cbiAgICAgICAqXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvbiB1c2VyIGFjdGlvblxuICAgICAgICpcbiAgICAgICAqICBAdXNhZ2VcbiAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX29uJyk7YFxuICAgICAgICovXG4gICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9vbicsIG9uV2ViY2FtT24pO1xuICAgICAgLyoqXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb2ZmXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXG4gICAgICAgKlxuICAgICAgICogIExpc3RlbmVyIGZvciBjYW1lcmEgb2ZmIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb2ZmJyk7YFxuICAgICAgICovXG4gICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9vZmYnLCBvbldlYmNhbU9mZik7XG5cbiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIHZtLmNvbmZpZyA9IHZtLmNvbmZpZyB8fCB7fTtcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VyV2lkdGgpKSB2bS5jb25maWcudmlld2VyV2lkdGggPSAnYXV0byc7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnZpZXdlckhlaWdodCkpIHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQgPSAnYXV0byc7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLm91dHB1dFdpZHRoKSkgdm0uY29uZmlnLm91dHB1dFdpZHRoID0gMzIwO1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQpKSB2bS5jb25maWcub3V0cHV0SGVpZ2h0ID0gMjQwO1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5kZWxheSkpIHZtLmNvbmZpZy5kZWxheSA9IDA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLnNob3RzKSkgdm0uY29uZmlnLnNob3RzID0gMTtcbiAgICAgICAgY29uZmlndXJlTGlzdGVuZXJzKCk7XG4gICAgICAgIGNvbmZpZ3VyZSgpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgICBXZWJjYW0ucmVzZXQoKTtcbiAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IGZhbHNlO1xuICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlKCkge1xuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuc2h1dHRlclVybCkpIHtcbiAgICAgICAgICBzb3VuZCA9IG5ldyBBdWRpbygpO1xuICAgICAgICAgIHNvdW5kLmF1dG9wbGF5ID0gZmFsc2U7XG4gICAgICAgICAgaWYobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvRmlyZWZveC8pKSB7XG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybC5zcGxpdCgnLicpWzBdICsgJy5vZ2cnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgV2ViY2FtLnNldCh7XG4gICAgICAgICAgd2lkdGg6IHZtLmNvbmZpZy52aWV3ZXJXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQsXG4gICAgICAgICAgZGVzdF93aWR0aDogdm0uY29uZmlnLm91dHB1dFdpZHRoLFxuICAgICAgICAgIGRlc3RfaGVpZ2h0OiB2bS5jb25maWcub3V0cHV0SGVpZ2h0LFxuICAgICAgICAgIGZvcmNlX2ZsYXNoOiBmYWxzZSxcbiAgICAgICAgICBpbWFnZV9mb3JtYXQ6ICdqcGVnJyxcbiAgICAgICAgICBqcGVnX3F1YWxpdHk6IDEwMFxuICAgICAgICB9KTtcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLmZsYXNoRmFsbGJhY2tVcmwpKSB7XG4gICAgICAgICAgV2ViY2FtLnNldFNXRkxvY2F0aW9uKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKTtcbiAgICAgICAgfVxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpKSB7XG4gICAgICAgICAgV2ViY2FtLnNldCgnZmxhc2hOb3REZXRlY3RlZFRleHQnLCB2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpO1xuICAgICAgICB9XG4gICAgICAgIFdlYmNhbS5hdHRhY2goJyNuZy13ZWJjYW0tY29udGFpbmVyJyk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZUxpc3RlbmVycygpIHtcbiAgICAgICAgV2ViY2FtLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxvYWQpKSB7XG4gICAgICAgICAgICAgIHZtLm9uTG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgV2ViY2FtLm9uKCdsaXZlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLndlYmNhbUxpdmUgPSB0cnVlO1xuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ub25MaXZlKSkge1xuICAgICAgICAgICAgICB2bS5vbkxpdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFdlYmNhbS5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkVycm9yKSkge1xuICAgICAgICAgICAgcmV0dXJuIHZtLm9uRXJyb3Ioe2VycjplcnJ9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjYXB0dXJlKGluZGV4KSB7XG4gICAgICAgIGlmKHNvdW5kKSB7XG4gICAgICAgICAgc291bmQucGxheSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGluZGV4ID09PSAodm0uY29uZmlnLnNob3RzLTEpKSB7XG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbCh0aW1lcik7XG4gICAgICAgIH1cbiAgICAgICAgV2ViY2FtLnNuYXAoZnVuY3Rpb24oZGF0YV91cmkpIHtcbiAgICAgICAgICBpbWFnZXNbaW5kZXhdID0gZGF0YV91cmk7XG4gICAgICAgICAgaWYoaW5kZXggPCAodm0uY29uZmlnLnNob3RzLTEpICYmIGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uQ2FwdHVyZVByb2dyZXNzKSkge1xuICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZCgoKGluZGV4KzEpICogMTAwKSAvIHZtLmNvbmZpZy5zaG90cyk7XG4gICAgICAgICAgICB2bS5vbkNhcHR1cmVQcm9ncmVzcyh7c3JjOiBkYXRhX3VyaSxwcm9ncmVzczogcHJvZ3Jlc3N9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkgJiYgYW5ndWxhci5pc0RlZmluZWQodm0ub25DYXB0dXJlQ29tcGxldGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdm0ub25DYXB0dXJlQ29tcGxldGUoe3NyYzogaW1hZ2VzfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1DYXB0dXJlKGV2ZW50KSB7XG4gICAgICAgICRsb2cuZGVidWcoJ25nV2ViY2FtQ29udHJvbGxlci5vbldlYmNhbUNhcHR1cmUoZXZlbnQpIDogJywgZXZlbnQpO1xuICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICB0aW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9LCAodm0uY29uZmlnLmRlbGF5ICogMTAwMCksIHZtLmNvbmZpZy5zaG90cyk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG9uV2ViY2FtT24oZXZlbnQpIHtcbiAgICAgICAgJGxvZy5kZWJ1ZygnbmdXZWJjYW1Db250cm9sbGVyLm9uV2ViY2FtT24oZXZlbnQpIDogJywgZXZlbnQpO1xuICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbU9mZihldmVudCkge1xuICAgICAgICAkbG9nLmRlYnVnKCduZ1dlYmNhbUNvbnRyb2xsZXIub25XZWJjYW1PZmYoZXZlbnQpIDogJywgZXZlbnQpO1xuICAgICAgICBkZXN0cm95KCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGhhc1VzZXJNZWRpYSgpIHtcbiAgICAgICAgcmV0dXJuICgkd2luZG93Lm5hdmlnYXRvci5nZXRVc2VyTWVkaWEgfHwgJHdpbmRvdy5uYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhIHx8XG4gICAgICAgICR3aW5kb3cubmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYSB8fCAkd2luZG93Lm5hdmlnYXRvci5tc0dldFVzZXJNZWRpYSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGJyb3dzZXJzKCkge1xuICAgICAgICAvKmpzaGludCBtYXhjb21wbGV4aXR5OiA0MCAqL1xuICAgICAgICB2YXIgdWE9ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCwgdGVtLFxuICAgICAgICAgICAgTT0gdWEubWF0Y2goLyhvcGVyYXxjaHJvbWV8c2FmYXJpfGZpcmVmb3h8bXNpZXx0cmlkZW50KD89XFwvKSlcXC8/XFxzKihcXGQrKS9pKSB8fCBbXTtcbiAgICAgICAgaWYoL3RyaWRlbnQvaS50ZXN0KE1bMV0pKXtcbiAgICAgICAgICB0ZW09ICAvXFxicnZbIDpdKyhcXGQrKS9nLmV4ZWModWEpIHx8IFtdO1xuICAgICAgICAgIHJldHVybiAnSUUgJysodGVtWzFdIHx8ICcnKTtcbiAgICAgICAgfVxuICAgICAgICBpZihNWzFdPT09ICdDaHJvbWUnKXtcbiAgICAgICAgICB0ZW09IHVhLm1hdGNoKC9cXGIoT1BSfEVkZ2UpXFwvKFxcZCspLyk7XG4gICAgICAgICAgaWYodGVtIT0gbnVsbCkgcmV0dXJuIHRlbS5zbGljZSgxKS5qb2luKCcgJykucmVwbGFjZSgnT1BSJywgJ09wZXJhJyk7XG4gICAgICAgIH1cbiAgICAgICAgTT0gTVsyXT8gW01bMV0sIE1bMl1dOiBbbmF2aWdhdG9yLmFwcE5hbWUsIG5hdmlnYXRvci5hcHBWZXJzaW9uLCAnLT8nXTtcbiAgICAgICAgaWYoKHRlbT0gdWEubWF0Y2goL3ZlcnNpb25cXC8oXFxkKykvaSkpIT0gbnVsbCkgTS5zcGxpY2UoMSwgMSwgdGVtWzFdKTtcbiAgICAgICAgcmV0dXJuIE0uam9pbignICcpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGlyZWN0aXZlO1xuICB9XG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
