!function(){"use strict";function n(){function n(n,e){return['<div ng-show="cam.webcamLive === true" class="ng-webcam" ng-class="{\'no-overlay\' : cam.counter === 0 || cam.config.countdown === 0}">','<span ng-show="cam.config.countdown >= 0" id="counter">{{cam.counter}}</span>','<div id="ng-webcam-container" class="ng-webcam-continer"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)&&(l.config.countdown=0),c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=3}function t(){angular.isDefined(l.config.shutterUrl)&&(g=new Audio,g.autoplay=!1,navigator.userAgent.match(/Firefox/)?g.src=l.config.shutterUrl.split(".")[0]+".ogg":g.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:!0}),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){if(angular.isDefined(l.onError))return l.onError({err:n})})}function a(n){g&&g.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(h[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:h})})}function r(){if(angular.isUndefined(l.config.countdown)){var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}else{if(void 0!==d)return;l.counter=3,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d);var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}},1e3,3)}}function f(){Webcam.attach("#ng-webcam-container")}function u(){i()}var g,s,d,l=this,h=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=3,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",u)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"cam",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwiYW5ndWxhciIsImlzVW5kZWZpbmVkIiwidmlld2VyV2lkdGgiLCJ2aWV3ZXJIZWlnaHQiLCJvdXRwdXRXaWR0aCIsIm91dHB1dEhlaWdodCIsImRlbGF5Iiwic2hvdHMiLCJjb3VudGRvd24iLCJjb25maWd1cmVMaXN0ZW5lcnMiLCJjb25maWd1cmUiLCJ3ZWJjYW1MaXZlIiwiV2ViY2FtIiwicmVzZXQiLCJ3ZWJjYW1Mb2FkZWQiLCJpc0RlZmluZWQiLCJzbmFwc2hvdFRpbWVyIiwiY2FuY2VsIiwidW5kZWZpbmVkIiwiY291bnRkb3duVGltZXIiLCJjb3VudGVyIiwic2h1dHRlclVybCIsInNvdW5kIiwiQXVkaW8iLCJhdXRvcGxheSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwic3JjIiwic3BsaXQiLCJzZXQiLCJ3aWR0aCIsImhlaWdodCIsImRlc3Rfd2lkdGgiLCJkZXN0X2hlaWdodCIsImZvcmNlX2ZsYXNoIiwiaW1hZ2VfZm9ybWF0IiwianBlZ19xdWFsaXR5IiwiZmxpcF9ob3JpeiIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImZsYXNoTm90RGV0ZWN0ZWRUZXh0IiwiYXR0YWNoIiwib24iLCIkYXBwbHkiLCJvbkxvYWQiLCJvbkxpdmUiLCJlcnIiLCJvbkVycm9yIiwiY2FwdHVyZSIsImluZGV4IiwicGxheSIsInNuYXAiLCJkYXRhX3VyaSIsImltYWdlcyIsIm9uQ2FwdHVyZVByb2dyZXNzIiwicHJvZ3Jlc3MiLCJNYXRoIiwicm91bmQiLCJvbkNhcHR1cmVDb21wbGV0ZSIsIm9uV2ViY2FtQ2FwdHVyZSIsImNvdW50Iiwib25XZWJjYW1PbiIsIm9uV2ViY2FtT2ZmIiwidGhpcyIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwiYmluZFRvQ29udHJvbGxlciIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCIkaW5qZWN0IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLFlBc0JBLFNBQUFBLEtBa0JBLFFBQUFDLEdBQUFDLEVBQUFDLEdBQ0EsT0FBQSwwSUFDQSxnRkFDQSxrRUFDQSxVQUFBQyxLQUFBLElBR0EsUUFBQUMsR0FBQUMsRUFBQUosRUFBQUMsRUFBQUksR0FDQUEsRUFBQUMsT0FDQUYsRUFBQUcsSUFBQSxXQUFBLFdBQ0FGLEVBQUFHLFlBTUEsUUFBQUMsR0FBQUMsRUFBQUMsR0E0Q0EsUUFBQUwsS0FDQU0sRUFBQUMsT0FBQUQsRUFBQUMsV0FDQUMsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUcsZUFBQUosRUFBQUMsT0FBQUcsWUFBQSxRQUNBRixRQUFBQyxZQUFBSCxFQUFBQyxPQUFBSSxnQkFBQUwsRUFBQUMsT0FBQUksYUFBQSxRQUNBSCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBSyxlQUFBTixFQUFBQyxPQUFBSyxZQUFBLEtBQ0FKLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFNLGdCQUFBUCxFQUFBQyxPQUFBTSxhQUFBLEtBQ0FMLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFPLFNBQUFSLEVBQUFDLE9BQUFPLE1BQUEsR0FDQU4sUUFBQUMsWUFBQUgsRUFBQUMsT0FBQVEsU0FBQVQsRUFBQUMsT0FBQVEsTUFBQSxHQUNBUCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBUyxhQUFBVixFQUFBQyxPQUFBUyxVQUFBLEdBQ0FDLElBQ0FDLElBR0EsUUFBQWhCLEtBQ0FJLEVBQUFhLFlBQUFDLE9BQUFDLFFBQ0FmLEVBQUFhLFlBQUEsRUFDQWIsRUFBQWdCLGNBQUEsRUFDQWQsUUFBQWUsVUFBQUMsS0FDQW5CLEVBQUFvQixPQUFBRCxHQUNBQSxFQUFBRSxRQUVBbEIsUUFBQWUsVUFBQUks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QWIsRUFBQXNCLFFBQUEsRUFDQXRCLEVBQUFOLEtBQUFBLEVBQ0FNLEVBQUFKLFFBQUFBLEVBV0FFLEVBQUFILElBQUEsbUJBQUFtRSxHQVdBaEUsRUFBQUgsSUFBQSxjQUFBcUUsR0FXQWxFLEVBQUFILElBQUEsZUFBQXNFLEdBM0VBLEdBQUFFLElBQ0FDLFNBQUEsSUFDQWpGLFNBQUFBLEVBQ0FJLEtBQUFBLEVBQ0E4RSxrQkFBQSxFQUNBQyxXQUFBekUsRUFDQTBFLGFBQUEsTUFDQS9FLE9BQ0FTLE9BQUEsSUFDQTRELGtCQUFBLElBQ0FYLFFBQUEsSUFDQUgsT0FBQSxJQUNBVSxrQkFBQSxJQUNBVCxPQUFBLEtBdU1BLE9BckxBbkQsR0FBQTJFLFNBQUEsU0FBQSxhQXFMQUwsRUExT0FqRSxRQUFBdUUsT0FBQSxnQkFBQU4sVUFBQSxXQUFBakYsR0FDQUEsRUFBQXNGIiwiZmlsZSI6Im5nLXdlYmNhbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIGFuZ3VsYXIubW9kdWxlKCduZy13ZWJjYW0nLCBbXSkuZGlyZWN0aXZlKCduZ1dlYmNhbScsIG5nV2ViY2FtKTtcclxuICBuZ1dlYmNhbS4kaW5qZWN0ID0gW107XHJcbiAgLyoqXHJcbiAgICogIEBuZ2RvYyBEaXJlY3RpdmVcclxuICAgKiAgQG5hbWUgbmctd2ViY2FtXHJcbiAgICogIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogIERpcmVjdGl2ZSBmb3IgY2FwdHVyaW5nIGltYWdlcyBmcm9tIHlvdXIgY29tcHV0ZXIncyBjYW1lcmEsIGFuZCBkZWxpdmVyeSB0aGVuIHRvIHlvdSBhcyBkYXRhIHVyaVxyXG4gICAqXHJcbiAgICogIEB1c2FnZVxyXG4gICAqICBgYGBodG1sXHJcbiAgICogIDxuZy13ZWJjYW1cclxuICAgKiAgICBjb25maWc9XCJ2bS5jb25maWdcIlxyXG4gICAqICAgIG9uLWVycm9yPVwidm0ub25FcnJvcihlcnIpXCJcclxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxyXG4gICAqICAgIG9uLWxpdmU9XCJ2bS5vbkxpdmUoKVwiXHJcbiAgICogICAgb24tY2FwdHVyZS1wcm9ncmVzcz1cInZtLm9uQ2FwdHVyZVByb2dyZXNzKHNyYywgcHJvZ3Jlc3MpXCJcclxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxyXG4gICAqICA8L25nLXdlYmNhbT5cclxuICAgKiAgYGBgXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gbmdXZWJjYW0oKSB7XHJcbiAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsXHJcbiAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXHJcbiAgICAgIGNvbnRyb2xsZXI6IG5nV2ViY2FtQ29udHJvbGxlcixcclxuICAgICAgY29udHJvbGxlckFzOiAnY2FtJyxcclxuICAgICAgc2NvcGU6IHtcclxuICAgICAgICBjb25maWc6ICc9JyxcclxuICAgICAgICBvbkNhcHR1cmVDb21wbGV0ZTogJyYnLFxyXG4gICAgICAgIG9uRXJyb3I6ICcmJyxcclxuICAgICAgICBvbkxvYWQ6ICcmJyxcclxuICAgICAgICBvbkNhcHR1cmVQcm9ncmVzczogJyYnLFxyXG4gICAgICAgIG9uTGl2ZTogJyYnXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gdGVtcGxhdGUoZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgcmV0dXJuIFsnPGRpdiBuZy1zaG93PVwiY2FtLndlYmNhbUxpdmUgPT09IHRydWVcIiBjbGFzcz1cIm5nLXdlYmNhbVwiIG5nLWNsYXNzPVwie1xcJ25vLW92ZXJsYXlcXCcgOiBjYW0uY291bnRlciA9PT0gMCB8fCBjYW0uY29uZmlnLmNvdW50ZG93biA9PT0gMH1cIj4nLFxyXG4gICAgICAgICc8c3BhbiBuZy1zaG93PVwiY2FtLmNvbmZpZy5jb3VudGRvd24gPj0gMFwiIGlkPVwiY291bnRlclwiPnt7Y2FtLmNvdW50ZXJ9fTwvc3Bhbj4nLFxyXG4gICAgICAgICc8ZGl2IGlkPVwibmctd2ViY2FtLWNvbnRhaW5lclwiIGNsYXNzPVwibmctd2ViY2FtLWNvbnRpbmVyXCI+PC9kaXY+JyxcclxuICAgICAgICAnPC9kaXY+J10uam9pbignJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgY3RybC5pbml0KCk7XHJcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBjdHJsLmRlc3Ryb3koKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdXZWJjYW1Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckaW50ZXJ2YWwnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBuZ1dlYmNhbUNvbnRyb2xsZXIoJHNjb3BlLCAkaW50ZXJ2YWwpIHtcclxuICAgICAgLypqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXHJcbiAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgIHZhciBzb3VuZCwgc25hcHNob3RUaW1lciwgY291bnRkb3duVGltZXI7XHJcbiAgICAgIHZhciBpbWFnZXMgPSBbXTtcclxuICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcclxuICAgICAgdm0uY291bnRlciA9IDM7XHJcbiAgICAgIHZtLmluaXQgPSBpbml0O1xyXG4gICAgICB2bS5kZXN0cm95ID0gZGVzdHJveTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcclxuICAgICAgICogIEBuYW1lIG5nV2ViY2FtX2NhcHR1cmVcclxuICAgICAgICogIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhcHR1cmUgdXNlciBhY3Rpb25cclxuICAgICAgICpcclxuICAgICAgICogIEB1c2FnZVxyXG4gICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9jYXB0dXJlJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fY2FwdHVyZScsIG9uV2ViY2FtQ2FwdHVyZSk7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXHJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vblxyXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9uIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb24nKTtgXHJcbiAgICAgICAqL1xyXG4gICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9vbicsIG9uV2ViY2FtT24pO1xyXG4gICAgICAvKipcclxuICAgICAgICogIEBuZ2RvYyBsaXN0ZW5lclxyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb2ZmXHJcbiAgICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAgICpcclxuICAgICAgICogIExpc3RlbmVyIGZvciBjYW1lcmEgb2ZmIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb2ZmJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fb2ZmJywgb25XZWJjYW1PZmYpO1xyXG5cclxuICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICB2bS5jb25maWcgPSB2bS5jb25maWcgfHwge307XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VyV2lkdGgpKSB2bS5jb25maWcudmlld2VyV2lkdGggPSAnYXV0byc7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VySGVpZ2h0KSkgdm0uY29uZmlnLnZpZXdlckhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRXaWR0aCkpIHZtLmNvbmZpZy5vdXRwdXRXaWR0aCA9IDMyMDtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQpKSB2bS5jb25maWcub3V0cHV0SGVpZ2h0ID0gMjQwO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmRlbGF5KSkgdm0uY29uZmlnLmRlbGF5ID0gMDtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5zaG90cykpIHZtLmNvbmZpZy5zaG90cyA9IDE7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSkgdm0uY29uZmlnLmNvdW50ZG93biA9IDA7XHJcbiAgICAgICAgY29uZmlndXJlTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgY29uZmlndXJlKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYodm0ud2ViY2FtTGl2ZSkgV2ViY2FtLnJlc2V0KCk7XHJcbiAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHNuYXBzaG90VGltZXIpKSB7XHJcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xyXG4gICAgICAgICAgc25hcHNob3RUaW1lciA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoY291bnRkb3duVGltZXIpKSB7XHJcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGNvdW50ZG93blRpbWVyKTtcclxuICAgICAgICAgIGNvdW50ZG93blRpbWVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5jb3VudGVyID0gMztcclxuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZSgpIHtcclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuc2h1dHRlclVybCkpIHtcclxuICAgICAgICAgIHNvdW5kID0gbmV3IEF1ZGlvKCk7XHJcbiAgICAgICAgICBzb3VuZC5hdXRvcGxheSA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvRmlyZWZveC8pKSB7XHJcbiAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsLnNwbGl0KCcuJylbMF0gKyAnLm9nZyc7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLnNldCh7XHJcbiAgICAgICAgICB3aWR0aDogdm0uY29uZmlnLnZpZXdlcldpZHRoLFxyXG4gICAgICAgICAgaGVpZ2h0OiB2bS5jb25maWcudmlld2VySGVpZ2h0LFxyXG4gICAgICAgICAgZGVzdF93aWR0aDogdm0uY29uZmlnLm91dHB1dFdpZHRoLFxyXG4gICAgICAgICAgZGVzdF9oZWlnaHQ6IHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQsXHJcbiAgICAgICAgICBmb3JjZV9mbGFzaDogZmFsc2UsXHJcbiAgICAgICAgICBpbWFnZV9mb3JtYXQ6ICdqcGVnJyxcclxuICAgICAgICAgIGpwZWdfcXVhbGl0eTogMTAwLFxyXG4gICAgICAgICAgZmxpcF9ob3JpejogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKSkge1xyXG4gICAgICAgICAgV2ViY2FtLnNldFNXRkxvY2F0aW9uKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KSkge1xyXG4gICAgICAgICAgV2ViY2FtLnNldCgnZmxhc2hOb3REZXRlY3RlZFRleHQnLCB2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBjb25maWd1cmVMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgV2ViY2FtLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxvYWQpKSB7XHJcbiAgICAgICAgICAgICAgdm0ub25Mb2FkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFdlYmNhbS5vbignbGl2ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uTGl2ZSkpIHtcclxuICAgICAgICAgICAgICB2bS5vbkxpdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgV2ViY2FtLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ub25FcnJvcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZtLm9uRXJyb3Ioe2VycjplcnJ9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY2FwdHVyZShpbmRleCkge1xyXG4gICAgICAgIGlmKHNvdW5kKSB7XHJcbiAgICAgICAgICBzb3VuZC5wbGF5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGluZGV4ID09PSAodm0uY29uZmlnLnNob3RzLTEpKSB7XHJcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBXZWJjYW0uc25hcChmdW5jdGlvbihkYXRhX3VyaSkge1xyXG4gICAgICAgICAgaW1hZ2VzW2luZGV4XSA9IGRhdGFfdXJpO1xyXG4gICAgICAgICAgaWYoaW5kZXggPCAodm0uY29uZmlnLnNob3RzLTEpICYmIGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uQ2FwdHVyZVByb2dyZXNzKSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKCgoaW5kZXgrMSkgKiAxMDApIC8gdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICAgICAgdm0ub25DYXB0dXJlUHJvZ3Jlc3Moe3NyYzogZGF0YV91cmkscHJvZ3Jlc3M6IHByb2dyZXNzfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVDb21wbGV0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZtLm9uQ2FwdHVyZUNvbXBsZXRlKHtzcmM6IGltYWdlc30pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbUNhcHR1cmUoKSB7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSkge1xyXG4gICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgIHNuYXBzaG90VGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xyXG4gICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgfSwgKHZtLmNvbmZpZy5kZWxheSAqIDEwMDApLCB2bS5jb25maWcuc2hvdHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZihjb3VudGRvd25UaW1lciAhPT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICB2bS5jb3VudGVyID0gMztcclxuICAgICAgICAgIGNvdW50ZG93blRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS5jb3VudGVyID0gdm0uY291bnRlciAtIDE7XHJcbiAgICAgICAgICAgIGlmKHZtLmNvdW50ZXIgPT09IDApIHtcclxuICAgICAgICAgICAgICBpZihjb3VudGRvd25UaW1lcikge1xyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChjb3VudGRvd25UaW1lcik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgc25hcHNob3RUaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgICB9LCAodm0uY29uZmlnLmRlbGF5ICogMTAwMCksIHZtLmNvbmZpZy5zaG90cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIDEwMDAsIDMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PbigpIHtcclxuICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbU9mZigpIHtcclxuICAgICAgICBkZXN0cm95KCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBkaXJlY3RpdmU7XHJcbiAgfVxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
