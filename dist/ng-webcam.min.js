!function(){"use strict";function n(){function n(n,e){return['<div ng-show="vm.webcamLive === true" class="ng-webcam" ng-class="{\'no-overlay\' : vm.counter === 0 || vm.config.countdown === 0}">','<span ng-show="vm.config.countdown > 0 && vm.counter > 0" id="ng-webcam-counter">{{vm.counter}}</span>','<img id="ng-webcam-overlay" src="{{vm.config.overlay}}" />','<div id="ng-webcam-container"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)&&(l.config.countdown=0),c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=3}function t(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:!0}),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){console.log("error.webcamjs = ",n),angular.isDefined(l.onError)&&l.onError({err:n})})}function a(n){u&&u.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(m[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:m})})}function r(){if(angular.isUndefined(l.config.countdown)){var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}else{if(void 0!==d)return;l.counter=3,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d);var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}},1e3,3)}}function f(){Webcam.attach("#ng-webcam-container")}function g(){i()}var u,s,d,l=this,m=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=3,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",g)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"vm",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwiYW5ndWxhciIsImlzVW5kZWZpbmVkIiwidmlld2VyV2lkdGgiLCJ2aWV3ZXJIZWlnaHQiLCJvdXRwdXRXaWR0aCIsIm91dHB1dEhlaWdodCIsImRlbGF5Iiwic2hvdHMiLCJjb3VudGRvd24iLCJjb25maWd1cmVMaXN0ZW5lcnMiLCJjb25maWd1cmUiLCJ3ZWJjYW1MaXZlIiwiV2ViY2FtIiwicmVzZXQiLCJ3ZWJjYW1Mb2FkZWQiLCJpc0RlZmluZWQiLCJzbmFwc2hvdFRpbWVyIiwiY2FuY2VsIiwidW5kZWZpbmVkIiwiY291bnRkb3duVGltZXIiLCJjb3VudGVyIiwic2h1dHRlclVybCIsInNvdW5kIiwiQXVkaW8iLCJhdXRvcGxheSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwic3JjIiwic3BsaXQiLCJzZXQiLCJ3aWR0aCIsImhlaWdodCIsImRlc3Rfd2lkdGgiLCJkZXN0X2hlaWdodCIsImZvcmNlX2ZsYXNoIiwiaW1hZ2VfZm9ybWF0IiwianBlZ19xdWFsaXR5IiwiZmxpcF9ob3JpeiIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImZsYXNoTm90RGV0ZWN0ZWRUZXh0IiwiYXR0YWNoIiwib24iLCIkYXBwbHkiLCJvbkxvYWQiLCJvbkxpdmUiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwib25FcnJvciIsImNhcHR1cmUiLCJpbmRleCIsInBsYXkiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXNCQSxTQUFBQSxLQWtCQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLE9BQUEsdUlBQ0EseUdBQ0EsNkRBQ0EsdUNBQ0EsVUFBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFKLEVBQUFDLEVBQUFJLEdBQ0FBLEVBQUFDLE9BQ0FGLEVBQUFHLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEdBNENBLFFBQUFMLEtBQ0FNLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFHLGVBQUFKLEVBQUFDLE9BQUFHLFlBQUEsUUFDQUYsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUksZ0JBQUFMLEVBQUFDLE9BQUFJLGFBQUEsUUFDQUgsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQUssZUFBQU4sRUFBQUMsT0FBQUssWUFBQSxLQUNBSixRQUFBQyxZQUFBSCxFQUFBQyxPQUFBTSxnQkFBQVAsRUFBQUMsT0FBQU0sYUFBQSxLQUNBTCxRQUFBQyxZQUFBSCxFQUFBQyxPQUFBTyxTQUFBUixFQUFBQyxPQUFBTyxNQUFBLEdBQ0FOLFFBQUFDLFlBQUFILEVBQUFDLE9BQUFRLFNBQUFULEVBQUFDLE9BQUFRLE1BQUEsR0FDQVAsUUFBQUMsWUFBQUgsRUFBQUMsT0FBQVMsYUFBQVYsRUFBQUMsT0FBQVMsVUFBQSxHQUNBQyxJQUNBQyxJQUdBLFFBQUFoQixLQUNBSSxFQUFBYSxZQUFBQyxPQUFBQyxRQUNBZixFQUFBYSxZQUFBLEVBQ0FiLEVBQUFnQixjQUFBLEVBQ0FkLFFBQUFlLFVBQUFDLEtBQ0FuQixFQUFBb0IsT0FBQUQsR0FDQUEsRUFB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MUQsR0FBQWdCLGNBQUEsRUFDQWhCLEVBQUFhLFlBQUEsRUFDQWIsRUFBQXNCLFFBQUEsRUFDQXRCLEVBQUFOLEtBQUFBLEVBQ0FNLEVBQUFKLFFBQUFBLEVBV0FFLEVBQUFILElBQUEsbUJBQUFxRSxHQVdBbEUsRUFBQUgsSUFBQSxjQUFBdUUsR0FXQXBFLEVBQUFILElBQUEsZUFBQXdFLEdBNUVBLEdBQUFFLElBQ0FDLFNBQUEsSUFDQW5GLFNBQUFBLEVBQ0FJLEtBQUFBLEVBQ0FnRixrQkFBQSxFQUNBQyxXQUFBM0UsRUFDQTRFLGFBQUEsS0FDQWpGLE9BQ0FTLE9BQUEsSUFDQThELGtCQUFBLElBQ0FYLFFBQUEsSUFDQUwsT0FBQSxJQUNBWSxrQkFBQSxJQUNBWCxPQUFBLEtBeU1BLE9BdExBbkQsR0FBQTZFLFNBQUEsU0FBQSxhQXNMQUwsRUE1T0FuRSxRQUFBeUUsT0FBQSxnQkFBQU4sVUFBQSxXQUFBbkYsR0FDQUEsRUFBQXdGIiwiZmlsZSI6Im5nLXdlYmNhbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIGFuZ3VsYXIubW9kdWxlKCduZy13ZWJjYW0nLCBbXSkuZGlyZWN0aXZlKCduZ1dlYmNhbScsIG5nV2ViY2FtKTtcclxuICBuZ1dlYmNhbS4kaW5qZWN0ID0gW107XHJcbiAgLyoqXHJcbiAgICogIEBuZ2RvYyBEaXJlY3RpdmVcclxuICAgKiAgQG5hbWUgbmctd2ViY2FtXHJcbiAgICogIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogIERpcmVjdGl2ZSBmb3IgY2FwdHVyaW5nIGltYWdlcyBmcm9tIHlvdXIgY29tcHV0ZXIncyBjYW1lcmEsIGFuZCBkZWxpdmVyeSB0aGVuIHRvIHlvdSBhcyBkYXRhIHVyaVxyXG4gICAqXHJcbiAgICogIEB1c2FnZVxyXG4gICAqICBgYGBodG1sXHJcbiAgICogIDxuZy13ZWJjYW1cclxuICAgKiAgICBjb25maWc9XCJ2bS5jb25maWdcIlxyXG4gICAqICAgIG9uLWVycm9yPVwidm0ub25FcnJvcihlcnIpXCJcclxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxyXG4gICAqICAgIG9uLWxpdmU9XCJ2bS5vbkxpdmUoKVwiXHJcbiAgICogICAgb24tY2FwdHVyZS1wcm9ncmVzcz1cInZtLm9uQ2FwdHVyZVByb2dyZXNzKHNyYywgcHJvZ3Jlc3MpXCJcclxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxyXG4gICAqICA8L25nLXdlYmNhbT5cclxuICAgKiAgYGBgXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gbmdXZWJjYW0oKSB7XHJcbiAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsXHJcbiAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXHJcbiAgICAgIGNvbnRyb2xsZXI6IG5nV2ViY2FtQ29udHJvbGxlcixcclxuICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICBzY29wZToge1xyXG4gICAgICAgIGNvbmZpZzogJz0nLFxyXG4gICAgICAgIG9uQ2FwdHVyZUNvbXBsZXRlOiAnJicsXHJcbiAgICAgICAgb25FcnJvcjogJyYnLFxyXG4gICAgICAgIG9uTG9hZDogJyYnLFxyXG4gICAgICAgIG9uQ2FwdHVyZVByb2dyZXNzOiAnJicsXHJcbiAgICAgICAgb25MaXZlOiAnJidcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiB0ZW1wbGF0ZShlbGVtZW50LCBhdHRycykge1xyXG4gICAgICByZXR1cm4gWyc8ZGl2IG5nLXNob3c9XCJ2bS53ZWJjYW1MaXZlID09PSB0cnVlXCIgY2xhc3M9XCJuZy13ZWJjYW1cIiBuZy1jbGFzcz1cIntcXCduby1vdmVybGF5XFwnIDogdm0uY291bnRlciA9PT0gMCB8fCB2bS5jb25maWcuY291bnRkb3duID09PSAwfVwiPicsXHJcbiAgICAgICAgJzxzcGFuIG5nLXNob3c9XCJ2bS5jb25maWcuY291bnRkb3duID4gMCAmJiB2bS5jb3VudGVyID4gMFwiIGlkPVwibmctd2ViY2FtLWNvdW50ZXJcIj57e3ZtLmNvdW50ZXJ9fTwvc3Bhbj4nLFxyXG4gICAgICAgICc8aW1nIGlkPVwibmctd2ViY2FtLW92ZXJsYXlcIiBzcmM9XCJ7e3ZtLmNvbmZpZy5vdmVybGF5fX1cIiAvPicsXHJcbiAgICAgICAgJzxkaXYgaWQ9XCJuZy13ZWJjYW0tY29udGFpbmVyXCI+PC9kaXY+JyxcclxuICAgICAgICAnPC9kaXY+J10uam9pbignJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgY3RybC5pbml0KCk7XHJcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBjdHJsLmRlc3Ryb3koKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdXZWJjYW1Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckaW50ZXJ2YWwnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBuZ1dlYmNhbUNvbnRyb2xsZXIoJHNjb3BlLCAkaW50ZXJ2YWwpIHtcclxuICAgICAgLypqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXHJcbiAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgIHZhciBzb3VuZCwgc25hcHNob3RUaW1lciwgY291bnRkb3duVGltZXI7XHJcbiAgICAgIHZhciBpbWFnZXMgPSBbXTtcclxuICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcclxuICAgICAgdm0uY291bnRlciA9IDM7XHJcbiAgICAgIHZtLmluaXQgPSBpbml0O1xyXG4gICAgICB2bS5kZXN0cm95ID0gZGVzdHJveTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcclxuICAgICAgICogIEBuYW1lIG5nV2ViY2FtX2NhcHR1cmVcclxuICAgICAgICogIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKlxyXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhcHR1cmUgdXNlciBhY3Rpb25cclxuICAgICAgICpcclxuICAgICAgICogIEB1c2FnZVxyXG4gICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9jYXB0dXJlJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fY2FwdHVyZScsIG9uV2ViY2FtQ2FwdHVyZSk7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXHJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vblxyXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9uIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb24nKTtgXHJcbiAgICAgICAqL1xyXG4gICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9vbicsIG9uV2ViY2FtT24pO1xyXG4gICAgICAvKipcclxuICAgICAgICogIEBuZ2RvYyBsaXN0ZW5lclxyXG4gICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fb2ZmXHJcbiAgICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAgICpcclxuICAgICAgICogIExpc3RlbmVyIGZvciBjYW1lcmEgb2ZmIHVzZXIgYWN0aW9uXHJcbiAgICAgICAqXHJcbiAgICAgICAqICBAdXNhZ2VcclxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb2ZmJyk7YFxyXG4gICAgICAgKi9cclxuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fb2ZmJywgb25XZWJjYW1PZmYpO1xyXG5cclxuICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICB2bS5jb25maWcgPSB2bS5jb25maWcgfHwge307XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VyV2lkdGgpKSB2bS5jb25maWcudmlld2VyV2lkdGggPSAnYXV0byc7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VySGVpZ2h0KSkgdm0uY29uZmlnLnZpZXdlckhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRXaWR0aCkpIHZtLmNvbmZpZy5vdXRwdXRXaWR0aCA9IDMyMDtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQpKSB2bS5jb25maWcub3V0cHV0SGVpZ2h0ID0gMjQwO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmRlbGF5KSkgdm0uY29uZmlnLmRlbGF5ID0gMDtcclxuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5zaG90cykpIHZtLmNvbmZpZy5zaG90cyA9IDE7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSkgdm0uY29uZmlnLmNvdW50ZG93biA9IDA7XHJcbiAgICAgICAgY29uZmlndXJlTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgY29uZmlndXJlKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYodm0ud2ViY2FtTGl2ZSkgV2ViY2FtLnJlc2V0KCk7XHJcbiAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHNuYXBzaG90VGltZXIpKSB7XHJcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xyXG4gICAgICAgICAgc25hcHNob3RUaW1lciA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoY291bnRkb3duVGltZXIpKSB7XHJcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGNvdW50ZG93blRpbWVyKTtcclxuICAgICAgICAgIGNvdW50ZG93blRpbWVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5jb3VudGVyID0gMztcclxuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZSgpIHtcclxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuc2h1dHRlclVybCkpIHtcclxuICAgICAgICAgIHNvdW5kID0gbmV3IEF1ZGlvKCk7XHJcbiAgICAgICAgICBzb3VuZC5hdXRvcGxheSA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvRmlyZWZveC8pKSB7XHJcbiAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsLnNwbGl0KCcuJylbMF0gKyAnLm9nZyc7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgV2ViY2FtLnNldCh7XHJcbiAgICAgICAgICB3aWR0aDogdm0uY29uZmlnLnZpZXdlcldpZHRoLFxyXG4gICAgICAgICAgaGVpZ2h0OiB2bS5jb25maWcudmlld2VySGVpZ2h0LFxyXG4gICAgICAgICAgZGVzdF93aWR0aDogdm0uY29uZmlnLm91dHB1dFdpZHRoLFxyXG4gICAgICAgICAgZGVzdF9oZWlnaHQ6IHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQsXHJcbiAgICAgICAgICBmb3JjZV9mbGFzaDogZmFsc2UsXHJcbiAgICAgICAgICBpbWFnZV9mb3JtYXQ6ICdqcGVnJyxcclxuICAgICAgICAgIGpwZWdfcXVhbGl0eTogMTAwLFxyXG4gICAgICAgICAgZmxpcF9ob3JpejogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKSkge1xyXG4gICAgICAgICAgV2ViY2FtLnNldFNXRkxvY2F0aW9uKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KSkge1xyXG4gICAgICAgICAgV2ViY2FtLnNldCgnZmxhc2hOb3REZXRlY3RlZFRleHQnLCB2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBjb25maWd1cmVMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgV2ViY2FtLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxvYWQpKSB7XHJcbiAgICAgICAgICAgICAgdm0ub25Mb2FkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFdlYmNhbS5vbignbGl2ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uTGl2ZSkpIHtcclxuICAgICAgICAgICAgICB2bS5vbkxpdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgV2ViY2FtLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yLndlYmNhbWpzID0gJywgZXJyKTtcclxuICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uRXJyb3IpKSB7XHJcbiAgICAgICAgICAgIHZtLm9uRXJyb3Ioe2VycjplcnJ9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY2FwdHVyZShpbmRleCkge1xyXG4gICAgICAgIGlmKHNvdW5kKSB7XHJcbiAgICAgICAgICBzb3VuZC5wbGF5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGluZGV4ID09PSAodm0uY29uZmlnLnNob3RzLTEpKSB7XHJcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBXZWJjYW0uc25hcChmdW5jdGlvbihkYXRhX3VyaSkge1xyXG4gICAgICAgICAgaW1hZ2VzW2luZGV4XSA9IGRhdGFfdXJpO1xyXG4gICAgICAgICAgaWYoaW5kZXggPCAodm0uY29uZmlnLnNob3RzLTEpICYmIGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uQ2FwdHVyZVByb2dyZXNzKSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKCgoaW5kZXgrMSkgKiAxMDApIC8gdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICAgICAgdm0ub25DYXB0dXJlUHJvZ3Jlc3Moe3NyYzogZGF0YV91cmkscHJvZ3Jlc3M6IHByb2dyZXNzfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVDb21wbGV0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZtLm9uQ2FwdHVyZUNvbXBsZXRlKHtzcmM6IGltYWdlc30pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbUNhcHR1cmUoKSB7XHJcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSkge1xyXG4gICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgIHNuYXBzaG90VGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xyXG4gICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgfSwgKHZtLmNvbmZpZy5kZWxheSAqIDEwMDApLCB2bS5jb25maWcuc2hvdHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZihjb3VudGRvd25UaW1lciAhPT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICB2bS5jb3VudGVyID0gMztcclxuICAgICAgICAgIGNvdW50ZG93blRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS5jb3VudGVyID0gdm0uY291bnRlciAtIDE7XHJcbiAgICAgICAgICAgIGlmKHZtLmNvdW50ZXIgPT09IDApIHtcclxuICAgICAgICAgICAgICBpZihjb3VudGRvd25UaW1lcikge1xyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChjb3VudGRvd25UaW1lcik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgc25hcHNob3RUaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgICB9LCAodm0uY29uZmlnLmRlbGF5ICogMTAwMCksIHZtLmNvbmZpZy5zaG90cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIDEwMDAsIDMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PbigpIHtcclxuICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbU9mZigpIHtcclxuICAgICAgICBkZXN0cm95KCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBkaXJlY3RpdmU7XHJcbiAgfVxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
